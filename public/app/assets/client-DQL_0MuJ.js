import{a as ne,c as Q,j as e,b as U,r,R as re}from"./index-D67P2Q6G.js";const ie=()=>{const a=new URLSearchParams(window.location.search).get("token");if(a)return a;try{return localStorage.getItem("clientToken")||""}catch{return""}},V=s=>{try{localStorage.setItem("clientToken",s)}catch{}},oe=()=>{try{localStorage.removeItem("clientToken")}catch{}};async function k(s){try{const a=await s.json();return(a==null?void 0:a.error)||(a==null?void 0:a.message)||`${s.status}`}catch{return`${s.status} ${s.statusText}`}}const P=(s,a,d)=>`<script ${["async",'src="https://before-after-embed.vercel.app/embed.js"',`data-embed-id="${s||"your-embed-id"}"`,`data-theme="${d}"`,`data-variant="${a}"`,'data-max-width="640px"','data-align="center"','data-radius="14px"','data-shadow="true"','data-border="true"','data-width="100%"','data-height="460px"'].join(" ")}><\/script>`,ce=({className:s="",children:a})=>e.jsx("div",{className:`mx-auto w-full max-w-6xl px-4 sm:px-6 ${s}`,children:a}),S=({title:s,children:a})=>e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-6",children:[s&&e.jsx("h2",{className:"text-base font-semibold",children:s}),e.jsx("div",{className:s?"mt-3":"",children:a})]}),x=({variant:s="primary",className:a="",children:d,...o})=>{const l="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition",g={primary:"text-white bg-gradient-to-r from-violet-600 via-pink-500 to-cyan-400 hover:opacity-90 disabled:opacity-60",outline:"border border-white/20 bg-transparent text-white hover:bg-white/10",subtle:"bg-white/10 text-white hover:bg-white/20"};return e.jsx("button",{className:`${l} ${g[s]} ${a}`,...o,children:d})},A=s=>e.jsx("input",{...s,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white placeholder-white/50 focus:ring-2 focus:ring-violet-500"}),y=({children:s,...a})=>e.jsx("select",{...a,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white focus:ring-2 focus:ring-violet-500",children:s}),le=({children:s})=>e.jsx("code",{className:"rounded-md bg-black/40 px-1.5 py-0.5 text-[12px]",children:s});function de(){const[s,a]=r.useState("");return r.useEffect(()=>{const o=new URLSearchParams(window.location.search),l=o.get("token")||ie();l&&(a(l),V(l),o.get("token")&&(o.delete("token"),window.history.replaceState({},"",window.location.pathname)))},[]),[s,o=>{a(o||""),o?V(o):oe()}]}function he(){const[s,a]=r.useState(""),[d,o]=r.useState(!1),[l,g]=r.useState(""),[v,u]=r.useState(""),j=async p=>{p.preventDefault(),o(!0),g(""),u("");try{const c=await fetch("/api/client/me",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})});if(!c.ok)throw new Error(await k(c));const h=await c.json();if(h!=null&&h.link)window.location.href=h.link;else if(h!=null&&h.token){const f=new URL(window.location.href);f.searchParams.set("token",h.token),window.location.replace(f.toString())}else u("Sign-in link sent. Check your email.")}catch(c){g(typeof(c==null?void 0:c.message)=="string"?c.message:"Failed to send sign-in link")}finally{o(!1)}};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-neutral-950 text-white",children:e.jsxs("form",{onSubmit:j,className:"w-full max-w-sm rounded-xl border border-white/10 bg-white/5 p-6",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Client Portal Sign In"}),e.jsx(A,{type:"email",placeholder:"you@example.com",value:s,onChange:p=>a(p.target.value),required:!0}),e.jsx(x,{type:"submit",className:"mt-4 w-full",disabled:d,children:d?"Sending…":"Send sign-in link"}),!!l&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:l}),!!v&&e.jsx("p",{className:"mt-2 text-sm text-white/70",children:v})]})})}function me({token:s,onSignOut:a}){var G,K;const[d,o]=r.useState(null),[l,g]=r.useState([]),[v,u]=r.useState(!0),[j,p]=r.useState(""),[c,h]=r.useState({id:"",vertical:"barber",theme:"dark"}),[f,R]=r.useState(""),[C,Z]=r.useState("compact"),[L,ee]=r.useState("dark"),N=r.useMemo(()=>P(f,C,L),[f,C,L]),[E,$]=r.useState(""),B=re.useRef(null);r.useEffect(()=>{$(N)},[N]);const O=t=>{var n;try{const i=B.current;if(!i)return;const m=i.contentDocument||((n=i.contentWindow)==null?void 0:n.document);if(!m)return;const w=`<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/></head><body style="margin:0;background:#0b0d10;color:#e6eaf2;font-family:Inter,ui-sans-serif,system-ui">${t}</body></html>`;m.open(),m.write(w),m.close()}catch{}};r.useEffect(()=>{const t=setTimeout(()=>O(E),250);return()=>clearTimeout(t)},[E]);const[T,D]=r.useState(""),[z,F]=r.useState([]),[M,_]=r.useState(!1),[b,J]=r.useState(null),[q,H]=r.useState(!1),I=async()=>{try{u(!0),p("");const t=await fetch("/api/client/me",{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error("Auth failed");const n=await t.json();o((n==null?void 0:n.client)||n);const i=await fetch("/api/client/embeds",{headers:{Authorization:`Bearer ${s}`}});if(!i.ok)throw new Error(await k(i));const m=await i.json(),w=Array.isArray(m)?m:(m==null?void 0:m.embeds)||[];g(w),!f&&w.length&&R(w[0].id),!T&&w.length&&D(w[0].id)}catch{p("Failed to load data")}finally{u(!1)}};r.useEffect(()=>{I()},[s]);const te=async t=>{t.preventDefault();try{const n=await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(c)});if(!n.ok)throw new Error(await k(n));h({id:"",vertical:c.vertical,theme:c.theme}),I()}catch(n){p(typeof(n==null?void 0:n.message)=="string"?n.message:"Failed to create embed")}},se=async(t,n)=>{try{const i=await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({id:t,theme:n})});if(!i.ok)throw new Error(await k(i));I()}catch(i){p(typeof(i==null?void 0:i.message)=="string"?i.message:"Failed to update embed")}},W=async t=>{if(t){_(!0);try{const n=await fetch(`/api/client/usage?embedId=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${s}`}});if(!n.ok)throw new Error(await k(n));const i=await n.json(),m=Array.isArray(i)?i:(i==null?void 0:i.events)||[];F(m)}catch{F([])}finally{_(!1)}}},ae=async()=>{H(!0);try{const t=await fetch("/api/client/stats",{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error(await k(t));const n=await t.json();J(n||null)}catch{J(null)}finally{H(!1)}};return v?e.jsx("div",{className:"p-6 text-white",children:"Loading…"}):j?e.jsx("div",{className:"p-6 text-red-400",children:j}):e.jsxs("div",{className:"min-h-screen bg-neutral-950 text-white",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-white/10 bg-neutral-950/80 backdrop-blur",children:e.jsxs(ce,{className:"flex h-14 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-8 w-8 place-items-center rounded-xl bg-gradient-to-tr from-violet-500 via-pink-500 to-cyan-400 shadow",children:e.jsx("span",{className:"text-xs font-bold",children:"B/A"})}),e.jsx("div",{className:"text-sm font-semibold",children:"Before/After Portal"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[d&&e.jsxs("span",{children:[d.name," (",e.jsx(le,{children:d.id}),")"]}),e.jsx(x,{variant:"outline",onClick:a,children:"Sign out"})]})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl space-y-8 p-4",children:[e.jsxs(S,{title:"Embeds",children:[e.jsx("ul",{className:"space-y-2 text-sm",children:l.map(t=>e.jsxs("li",{className:"flex flex-col gap-2 rounded-md border border-white/10 bg-black/20 p-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"truncate",children:[t.id," – ",t.vertical," – ",t.theme]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(y,{value:t.theme,onChange:n=>se(t.id,n.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(x,{variant:"subtle",onClick:()=>R(t.id),children:"Use in Snippet"}),e.jsx(x,{variant:"outline",onClick:()=>navigator.clipboard.writeText(P(t.id,C,t.theme)),children:"Copy Snippet"}),e.jsx("a",{className:"text-xs underline",target:"_blank",rel:"noreferrer",href:`/widget.html?embedId=${encodeURIComponent(t.id)}&theme=${encodeURIComponent(t.theme)}`,children:"Open"})]})]},t.id))}),e.jsxs("form",{onSubmit:te,className:"mt-4 grid gap-2 md:grid-cols-4",children:[e.jsx(A,{placeholder:"id",value:c.id,onChange:t=>h({...c,id:t.target.value}),required:!0}),e.jsxs(y,{value:c.vertical,onChange:t=>h({...c,vertical:t.target.value}),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]}),e.jsxs(y,{value:c.theme,onChange:t=>h({...c,theme:t.target.value}),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(x,{type:"submit",className:"md:col-span-4",children:"Create"})]})]}),e.jsxs(S,{title:"Snippet Builder",children:[e.jsxs("div",{className:"grid gap-2 md:grid-cols-3",children:[e.jsx(A,{placeholder:"embedId",value:f,onChange:t=>R(t.target.value)}),e.jsxs(y,{value:C,onChange:t=>Z(t.target.value),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]}),e.jsxs(y,{value:L,onChange:t=>ee(t.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]})]}),e.jsx("pre",{className:"mt-4 whitespace-pre-wrap break-words rounded-md bg-black/60 p-2 text-xs",children:N}),e.jsx(x,{className:"mt-2",onClick:()=>navigator.clipboard.writeText(N),children:"Copy snippet"})]}),e.jsx(S,{title:"Live Snippet Preview (iframe sandbox)",children:e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("textarea",{value:E,onChange:t=>$(t.target.value),rows:10,className:"w-full rounded-md border border-white/10 bg-black/40 p-2 text-xs font-mono"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(x,{variant:"subtle",onClick:()=>$(N),children:"Reset to builder"}),e.jsx(x,{onClick:()=>O(E),children:"Run preview"})]})]}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-black/20 p-2",children:e.jsx("iframe",{ref:B,title:"snippet-preview",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:"520px",border:"0",borderRadius:"10px",background:"#0b0d10"}})})]})}),e.jsxs(S,{title:"Usage",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(y,{value:T,onChange:t=>{D(t.target.value),W(t.target.value)},children:l.map(t=>e.jsx("option",{value:t.id,children:t.id},t.id))}),e.jsx(x,{variant:"subtle",onClick:()=>W(T),disabled:!T||M,children:M?"Loading…":"Refresh"})]}),z.length===0?e.jsx("div",{className:"text-sm text-white/70",children:"No events yet."}):e.jsx("ul",{className:"space-y-1 text-xs",children:z.map(t=>e.jsxs("li",{className:"rounded border border-white/10 bg-black/20 p-2",children:[e.jsx("span",{className:"opacity-80",children:t.event})," · ",e.jsx("span",{className:"opacity-60",children:new Date(t.ts).toLocaleString()})]},t.id||t.ts))})]}),e.jsxs(S,{title:"Stats (last 24h)",children:[e.jsx("div",{className:"mb-2",children:e.jsx(x,{variant:"subtle",onClick:ae,disabled:q,children:q?"Loading…":"Refresh stats"})}),b?e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((G=b==null?void 0:b.totals)==null?void 0:G.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Total events"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((K=b==null?void 0:b.last24h)==null?void 0:K.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Events (24h)"})]})]}):e.jsx("div",{className:"text-sm text-white/70",children:"No stats yet."})]})]})]})}function X(){const[s,a]=de();return s?e.jsx(me,{token:s,onSignOut:()=>{a(""),window.location.href="/app/client.html"}}):e.jsx(he,{})}const Y=()=>{const s=document.getElementById("root");s&&(ne&&typeof Q.createRoot=="function"?Q.createRoot(s).render(e.jsx(X,{})):U&&typeof U.render=="function"&&U.render(e.jsx(X,{}),s))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Y,{once:!0}):Y();(function(){if(new URLSearchParams(window.location.search).get("devtest")!=="1")return;const d=[],o=(u,j,p="")=>d.push({name:u,pass:!!j,detail:p}),l=P("abc","compact","dark");o("snippet has script tag",/^<script\s.+><\/script>$/.test(l)),o("includes data-embed-id",l.includes('data-embed-id="abc"')),o("includes variant",l.includes('data-variant="compact"')),o("includes theme",l.includes('data-theme="dark"'));const g=new URL(window.location.href);g.searchParams.set("token","T_URL");const v=g.searchParams.get("token")==="T_URL";o("URLSearchParams working",v),console.table(d.map(u=>({test:u.name,pass:u.pass,detail:u.detail})))})();
