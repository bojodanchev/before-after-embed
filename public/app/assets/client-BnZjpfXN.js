import{R as Ie,j as e,a as Ke,c as Ue,b as ne,r as i}from"./index-D4XdNw0m.js";const Ye=()=>{const r=new URLSearchParams(window.location.search).get("token");if(r)return r;try{return localStorage.getItem("clientToken")||""}catch{return""}},Ae=a=>{try{localStorage.setItem("clientToken",a)}catch{}},Qe=()=>{try{localStorage.removeItem("clientToken")}catch{}};async function K(a){try{const r=await a.json();return(r==null?void 0:r.error)||(r==null?void 0:r.message)||`${a.status}`}catch{return`${a.status} ${a.statusText}`}}const Xe="https://before-after-embed.vercel.app/embed.js",et=a=>a.replace(/[A-Z]/g,r=>`-${r.toLowerCase()}`),oe=(a,r={},m={})=>{const u={embedId:a||"your-embed-id",..."attrs"in r?r.attrs:r,...m},h=["async",`src="${Xe}"`];return Object.entries(u).forEach(([y,N])=>{if(N==null||N==="")return;const v=`data-${et(y.replace(/^data-/,""))}`;h.push(`${v}="${String(N)}"`)}),`<script ${h.join(" ")}><\/script>`},tt=[{id:"light",name:"Light",subtitle:"Bright card for white backgrounds",attrs:{theme:"light",wide:"true",border:"true",shadow:"false",radius:"18px",align:"center",height:"520px"},preview:{bg:"#f8fafc",fg:"#0f172a"},copy:{headline:"Show the transformation instantly",body:"Upload, generate, and drag the slider so customers see the clean finish before booking."}},{id:"dark",name:"Dark",subtitle:"Glassmorphism card for dark sites",attrs:{theme:"dark",wide:"true",border:"true",shadow:"true",radius:"20px",align:"center",height:"520px"},preview:{bg:"#0b1120",fg:"#f8fafc"},copy:{headline:"Bring the shine forward",body:"Let visitors preview your AI enhancements without leaving the page."}},{id:"brand",name:"Brand color",subtitle:"Uses your accent color for buttons and pills",attrs:{theme:"light",wide:"true",border:"true",shadow:"true",radius:"18px",align:"center",height:"520px"},preview:{bg:"#ffffff",fg:"#0f172a"},copy:{headline:"Spotlight your signature look",body:"Buttons, pills, and slider accents inherit your brand color automatically."}},{id:"minimal",name:"Minimal",subtitle:"Compact embed for sidebars and narrow sections",attrs:{theme:"auto",wide:"false",border:"false",shadow:"false",radius:"8px",align:"left",height:"420px"},preview:{bg:"#f1f5f9",fg:"#111827"},copy:{headline:"Drop into any sidebar",body:"The compact layout keeps controls stacked for a quick install."}}],st=({className:a="",children:r})=>e.jsx("div",{className:`mx-auto w-full max-w-6xl px-4 sm:px-6 ${a}`,children:r}),ee=({title:a,children:r})=>e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-6",children:[a&&e.jsx("h2",{className:"text-base font-semibold",children:a}),e.jsx("div",{className:a?"mt-3":"",children:r})]}),w=({variant:a="primary",className:r="",children:m,...u})=>{const h="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition",y={primary:"text-white bg-gradient-to-r from-violet-600 via-pink-500 to-cyan-400 hover:opacity-90 disabled:opacity-60",outline:"border border-white/20 bg-transparent text-white hover:bg-white/10",subtle:"bg-white/10 text-white hover:bg-white/20"};return e.jsx("button",{className:`${h} ${y[a]} ${r}`,...u,children:m})},M=a=>e.jsx("input",{...a,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white placeholder-white/50 focus:ring-2 focus:ring-violet-500"}),T=({children:a,...r})=>e.jsx("select",{...r,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white focus:ring-2 focus:ring-violet-500",children:a}),at=({children:a})=>e.jsx("code",{className:"rounded-md bg-black/40 px-1.5 py-0.5 text-[12px]",children:a}),R=({children:a})=>e.jsx("span",{className:"text-xs font-medium text-white/70",children:a}),De=["#f97316","#6366f1","#22d3ee","#ef4444","#10b981","#fbbf24"],rt=({t:a,canCustomize:r,brandColor:m,onApply:u,onPreview:h,setToast:y})=>{const N=r?De.length:2,v=i.useRef(null),[L,B]=i.useState(!1),[p,O]=i.useState(null);i.useEffect(()=>{O(null)},[r]);const U=(g,S)=>{g&&(S&&!r?(h(g),O(g),y(a("Previewing premium color — upgrade to save","Преглед на премиум цвят — ъпгрейд за запис"))):(h(null),u(g),O(null)))},te=(g,S)=>{const l=!r&&S>=N;U(g,l)},o=()=>{var g;(g=v.current)==null||g.click()},j=g=>new Promise((S,l)=>{const k=new FileReader;k.onload=()=>{const Y=new Image;Y.onload=()=>{try{const F=document.createElement("canvas"),J=48;F.width=J,F.height=J;const se=F.getContext("2d");se.drawImage(Y,0,0,J,J);const P=se.getImageData(0,0,J,J).data;let I=0,G=0,_=0,z=P.length/4;for(let C=0;C<P.length;C+=4)I+=P[C],G+=P[C+1],_+=P[C+2];I=Math.round(I/z),G=Math.round(G/z),_=Math.round(_/z);const q=`#${[I,G,_].map(C=>C.toString(16).padStart(2,"0")).join("")}`;S(q)}catch(F){l(F)}},Y.onerror=l,Y.src=k.result},k.onerror=l,k.readAsDataURL(g)}),A=async g=>{var l;const S=(l=g.target.files)==null?void 0:l[0];if(g.target.value="",!!S){B(!0);try{const k=await j(S);U(k,!r)}catch{y(a("Could not read that logo. Try another image.","Неуспешно извличане от логото. Опитайте друг файл."))}finally{B(!1)}}};return e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{children:a("Brand color","Бранд цвят")}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:a("Tint buttons and active chips","Акцентиран цвят")}),!r&&e.jsx("span",{className:"text-xs text-white/50",children:a("Upgrade for more","Ъпгрейд за повече")})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[De.map((g,S)=>{const l=(m==null?void 0:m.toLowerCase())===g.toLowerCase()||p===g,k=!r&&S>=N;return e.jsx("button",{type:"button",className:`h-8 w-8 rounded-full border transition ${l?"border-white":"border-white/10"} ${k?"opacity-50":""}`,style:{background:g},onClick:()=>te(g,S),"aria-label":`Accent ${g}${k?" (locked)":""}`},g)}),e.jsx("button",{type:"button",onClick:o,className:"inline-flex items-center gap-1 rounded-full border border-white/20 bg-white/10 px-3 py-1 text-xs text-white hover:bg-white/20",disabled:L,children:L?a("Detecting…","Извличане…"):a("Match logo","Цвят от лого")}),e.jsx("input",{ref:v,type:"file",accept:"image/*",className:"hidden",onChange:A}),r&&e.jsx("input",{type:"color",value:m,onChange:g=>U(g.target.value,!1),className:"h-8 w-12 cursor-pointer rounded border border-white/20 bg-transparent","aria-label":"Custom color"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/60",children:[e.jsxs("span",{children:[a("Current accent","Текущ акцент"),": ",m]}),p&&!r&&e.jsx("span",{className:"rounded bg-white/10 px-2 py-0.5 text-[10px] text-amber-300",children:a("Preview only • upgrade to apply","Само преглед • ъпгрейд за запис")})]})]})};function it(){const[a,r]=i.useState("");return i.useEffect(()=>{const u=new URLSearchParams(window.location.search),h=u.get("token")||Ye();h&&(r(h),Ae(h),u.get("token")&&(u.delete("token"),window.history.replaceState({},"",window.location.pathname)))},[]),[a,u=>{r(u||""),u?Ae(u):Qe()}]}function nt(){const[a,r]=i.useState(""),[m,u]=i.useState(!1),[h,y]=i.useState(""),[N,v]=i.useState(""),L=async()=>{u(!0),y(""),v("");try{const p=await fetch("/api/client/me",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})});if(!p.ok)throw new Error(await K(p));await p.json(),v("Sign-in link sent. Check your email.")}catch(p){y(typeof(p==null?void 0:p.message)=="string"?p.message:"Failed to send sign-in link")}finally{u(!1)}},B=async p=>{p.preventDefault(),m||L()};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-neutral-950 text-white",children:e.jsxs("form",{onSubmit:B,className:"w-full max-w-sm rounded-xl border border-white/10 bg-white/5 p-6",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Client Portal Sign In"}),e.jsx(M,{type:"email",placeholder:"you@example.com",value:a,onChange:p=>r(p.target.value),required:!0}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx(w,{type:"submit",className:"flex-1",disabled:m,children:m?"Sending…":"Send link"}),e.jsx(w,{type:"button",variant:"subtle",disabled:m||!a,onClick:L,children:"Resend"})]}),!!h&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:h}),!!N&&e.jsx("p",{className:"mt-2 text-sm text-white/70",children:N})]})})}function lt({token:a,onSignOut:r}){var Ne,Se,ke,Ce,$e,Ee,Te,Be,Le,Pe;const[m,u]=i.useState(null),[h,y]=i.useState([]),[N,v]=i.useState(!0),[L,B]=i.useState(""),[p,O]=i.useState({id:"",vertical:"barber",theme:"dark"}),[U,te]=i.useState(()=>{try{return localStorage.getItem("lang")||"en"}catch{return"en"}});i.useEffect(()=>{try{localStorage.setItem("lang",U)}catch{}},[U]);const o=(t,s)=>U==="bg"?s:t,[j,A]=i.useState(null),[g,S]=i.useState(!1),[l,k]=i.useState(null),[Y,F]=i.useState(0),[J,se]=i.useState(0),[P,I]=i.useState(""),[G,_]=i.useState(null),z=G||(j==null?void 0:j.brandColor)||"#f97316",q=i.useMemo(()=>tt.map(t=>t.id==="brand"?{...t,attrs:{...t.attrs,brandColor:z},preview:{...t.preview,accent:z}}:t),[z]),[C,_e]=i.useState("light"),b=i.useMemo(()=>q.find(t=>t.id===C)||q[0],[q,C]),Q=i.useMemo(()=>{var n,c;const t=P||((n=h[0])==null?void 0:n.id)||"your-embed-id",s=(c=h.find(x=>x.id===t))==null?void 0:c.vertical;return oe(t,b||{},s?{vertical:s}:{})},[P,h,b]),de=Ie.useRef(null),ce=(t="")=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),he=t=>{var s,n,c,x,Z,$;try{const E=de.current;if(!E)return;const re=E.contentDocument||((s=E.contentWindow)==null?void 0:s.document);if(!re)return;const X=b||{},qe=((n=X.preview)==null?void 0:n.bg)||"#0b1120",He=((c=X.preview)==null?void 0:c.fg)||"#f8fafc",Re=((x=X.attrs)==null?void 0:x.align)==="left"?"flex-start":"center",We=ce(((Z=X.copy)==null?void 0:Z.headline)||"Before & After preview"),Ve=ce((($=X.copy)==null?void 0:$.body)||"Upload, generate, and drag the slider to compare results."),Ze=`<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/></head><body style="margin:0;background:${qe};color:${He};font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;display:flex;flex-direction:column;gap:16px;align-items:${Re};padding:32px 24px;"><div style="max-width:680px;text-align:${Re==="center"?"center":"left"}"><h2 style="margin:0;font-size:22px;font-weight:600;">${We}</h2><p style="margin:8px 0 0;font-size:14px;opacity:0.78;">${Ve}</p></div>${t}</body></html>`;re.open(),re.write(Ze),re.close()}catch{}};i.useEffect(()=>{const t=setTimeout(()=>he(Q),200);return()=>clearTimeout(t)},[Q,b]),i.useEffect(()=>{_(null)},[j==null?void 0:j.brandColor]),i.useEffect(()=>{const t=new URLSearchParams(window.location.search);if(t.get("showInstaller")==="1"){je(!0),t.delete("showInstaller");const s=new URL(window.location.href);s.search=t.toString(),window.history.replaceState({},"",s.toString())}},[]);const[H,me]=i.useState(""),[xe,ue]=i.useState([]),[pe,ge]=i.useState(!1),[be,W]=i.useState(""),[d,fe]=i.useState(null),[we,ve]=i.useState(!1),[ot,je]=i.useState(!1),[dt,ze]=i.useState(1),[ct,ht]=i.useState("wide"),[Fe,ae]=i.useState(!1),[f,D]=i.useState({id:"",name:"",vertical:"barber",theme:"dark",width:"100%",height:"520px",variant:"card",radius:"12px",shadow:"true",border:"true"}),V=async()=>{try{v(!0),B("");const t=await fetch("/api/client/me",{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Auth failed");const s=await t.json();u((s==null?void 0:s.client)||s);const n=await fetch("/api/client/embeds",{headers:{Authorization:`Bearer ${a}`}});if(!n.ok)throw new Error(await K(n));const c=await n.json(),x=Array.isArray(c)?c:(c==null?void 0:c.embeds)||[];y(x);try{const $=await(await fetch("/api/client/settings",{headers:{Authorization:`Bearer ${a}`}})).json();A(($==null?void 0:$.settings)||{}),k(($==null?void 0:$.plan)||null)}catch{}!P&&x.length&&I(x[0].id),!H&&x.length&&me(x[0].id)}catch{B("Failed to load data")}finally{v(!1)}};i.useEffect(()=>{V()},[a]),i.useEffect(()=>{(async()=>{try{const t=new URLSearchParams(window.location.search),s=t.get("nextPlan");if(!s)return;t.delete("nextPlan");const n=new URL(window.location.href);n.search=t.toString(),window.history.replaceState({},"",n.toString());const c=await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({planId:s})}),x=await c.json();if(!c.ok)throw new Error((x==null?void 0:x.error)||"Checkout failed");x!=null&&x.url&&(window.location.href=x.url)}catch{}})()},[a]);const Je=async t=>{t.preventDefault();try{const s=await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(p)});if(!s.ok)throw new Error(await K(s));O({id:"",vertical:p.vertical,theme:p.theme}),V()}catch(s){B(typeof(s==null?void 0:s.message)=="string"?s.message:"Failed to create embed")}},Ge=async(t,s)=>{try{const n=await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({id:t,theme:s})});if(!n.ok)throw new Error(await K(n));V()}catch(n){B(typeof(n==null?void 0:n.message)=="string"?n.message:"Failed to update embed")}},ie=async t=>{if(t){ge(!0);try{const s=await fetch(`/api/client/stats?embedId=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${a}`}});if(!s.ok)throw new Error(await K(s));const n=await s.json(),c=Array.isArray(n)?n:(n==null?void 0:n.events)||[];ue(c)}catch{ue([])}finally{ge(!1)}}},ye=async()=>{ve(!0);try{const t=await fetch("/api/client/stats",{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error(await K(t));const s=await t.json();fe(s||null);try{const n=await fetch("/api/client/stats",{headers:{Authorization:`Bearer ${a}`}}),c=await n.json();if(!n.ok)throw new Error((c==null?void 0:c.error)||"Failed");k(c.plan||null),F(Number(c.monthlyUsed||0)),se(Number(c.monthlyBonus||0))}catch{}}catch{fe(null)}finally{ve(!1)}};return i.useEffect(()=>{const t=new URLSearchParams(window.location.search);if(t.get("success")==="1"){const s=t.get("topup")||t.get("plan")?t.get("topup")?`+${t.get("topup")} generations`:"Plan updated":"Success";W(`${s} 🎉`),setTimeout(()=>W(""),3e3),t.delete("success"),t.delete("topup"),t.delete("plan");const n=new URL(window.location.href);n.search=t.toString(),window.history.replaceState({},"",n.toString()),ye(),H&&ie(H)}},[]),N?e.jsx("div",{className:"p-6 text-white",children:"Loading…"}):L?e.jsx("div",{className:"p-6 text-red-400",children:L}):e.jsxs("div",{className:"min-h-screen bg-neutral-950 text-white",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-white/10 bg-neutral-950/80 backdrop-blur",children:e.jsxs(st,{className:"flex h-14 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-8 w-8 place-items-center rounded-xl bg-gradient-to-tr from-violet-500 via-pink-500 to-cyan-400 shadow",children:e.jsx("span",{className:"text-xs font-bold",children:"B/A"})}),e.jsx("div",{className:"text-sm font-semibold",children:o("Before/After Portal","Портал Before/After")})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[m&&e.jsxs("span",{children:[m.name," (",e.jsx(at,{children:m.id}),")"]}),e.jsx(w,{variant:"outline",onClick:r,children:o("Sign out","Изход")}),e.jsxs("div",{className:"inline-flex items-center rounded-md border border-white/20 bg-white/5 p-0.5",children:[e.jsx("button",{onClick:()=>te("en"),className:`${U==="en"?"bg-white/20 text-white":"text-white/80"} rounded px-2 py-1 text-xs`,children:"EN"}),e.jsx("button",{onClick:()=>te("bg"),className:`${U==="bg"?"bg-white/20 text-white":"text-white/80"} rounded px-2 py-1 text-xs`,children:"BG"})]})]})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl space-y-8 p-4",children:[!!be&&e.jsx("div",{className:"fixed right-4 top-16 z-50 rounded-lg border border-emerald-400/30 bg-emerald-500/15 px-3 py-2 text-sm text-emerald-300 shadow-lg",children:be}),!h.length&&e.jsxs("div",{className:"rounded-xl border border-white/10 bg-amber-500/10 p-4 text-sm text-amber-100",children:[o("New here? Use the guided setup to embed your widget in three quick steps.","За първи път сте тук? Пуснете ръководството за настройка в три стъпки."),e.jsx(w,{className:"ml-3",variant:"subtle",onClick:()=>{ze(1),je(!0)},children:o("Start guided setup","Стартирайте ръководството")})]}),e.jsxs(ee,{title:o("Embeds","Ембедове"),children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between rounded-md border border-white/10 bg-black/30 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"opacity-70",children:o("Current plan","Текущ план")}),e.jsx("div",{className:"font-medium",children:(l==null?void 0:l.name)||(l==null?void 0:l.id)||"free"})]}),e.jsx("div",{className:"rounded border border-white/10 bg-black/40 px-2 py-1 text-xs opacity-80",children:(()=>{const t=((l==null?void 0:l.id)||"free")==="free";return`${o("Watermark","Воден знак")}: ${t?o("active","активен"):o("removed","премахнат")}`})()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-xs opacity-70",children:[(l==null?void 0:l.monthlyGenerations)??0," ",o("gens / mo","ген./месец")]}),e.jsx("a",{href:"/app/pricing.html",className:"underline",children:o("Change plan","Промяна на план")}),e.jsx("button",{className:"rounded-md border border-white/20 bg-white/10 px-2 py-1 text-xs hover:bg-white/20",onClick:async()=>{try{const t=await fetch("/api/billing/topup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({units:1})}),s=await t.json();if(!t.ok)throw new Error((s==null?void 0:s.error)||"Top-up failed");s!=null&&s.url&&(window.location.href=s.url)}catch(t){alert(t.message||"Top-up failed")}},children:o("Buy +100","Купи +100")})]})]}),e.jsx("ul",{className:"space-y-2 text-sm",children:h.map(t=>e.jsxs("li",{className:"flex flex-col gap-2 rounded-md border border-white/10 bg-black/20 p-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"truncate",children:[t.id," – ",t.vertical," – ",t.theme]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(T,{value:t.theme,onChange:s=>Ge(t.id,s.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(w,{variant:"outline",onClick:()=>{I(t.id),W(`${o("Snippet builder now uses","Снипетът вече използва")} ${t.id}`)},children:"Use in builder"}),e.jsx(w,{variant:"outline",onClick:()=>{D({...t,variant:t.variant||"card",radius:t.radius||"12px",shadow:t.shadow??"true",border:t.border??"true"}),ae(!0)},children:o("Edit","Редакция")}),e.jsx(w,{variant:"outline",onClick:async()=>{const s=`${t.id}-copy`;await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({...t,id:s,name:t.name||s})}),V()},children:o("Duplicate","Дублирай")}),e.jsx(w,{variant:"outline",onClick:async()=>{if(!confirm(`Delete embed ${t.id}?`))return;const s=new URL("/api/client/embeds",location.origin);s.searchParams.set("id",t.id),await fetch(s.toString(),{method:"DELETE",headers:{Authorization:`Bearer ${a}`}}),V()},children:o("Delete","Изтрий")})]})]},t.id))}),e.jsxs("form",{onSubmit:Je,className:"mt-4 grid gap-2 md:grid-cols-4",children:[e.jsx(M,{placeholder:"id",value:p.id,onChange:t=>O({...p,id:t.target.value}),required:!0}),e.jsxs(T,{value:p.vertical,onChange:t=>O({...p,vertical:t.target.value}),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]}),e.jsxs(T,{value:p.theme,onChange:t=>O({...p,theme:t.target.value}),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(w,{type:"submit",className:"md:col-span-4",children:"Create"})]})]}),e.jsx(ee,{title:"Client settings",children:j?e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{children:"Display name"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Shown only in your portal"})]}),e.jsx(M,{value:j.displayName||"",onChange:t=>A(s=>({...s,displayName:t.target.value}))})]}),e.jsx(rt,{t:o,canCustomize:(l==null?void 0:l.themeCustomization)==="custom",brandColor:z,onPreview:t=>_(t),onApply:t=>A(s=>({...s,brandColor:t})),setToast:W}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{children:"Default theme"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Light or dark for new embeds"})]}),e.jsxs(T,{value:j.defaultTheme||"dark",onChange:t=>A(s=>({...s,defaultTheme:t.target.value})),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{children:"Default variant"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Compact (inline) or Card (iframe)"})]}),e.jsxs(T,{value:j.defaultVariant||"card",onChange:t=>A(s=>({...s,defaultVariant:t.target.value})),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]})]}),e.jsxs("details",{className:"md:col-span-2 rounded-md border border-white/10 bg-black/30 p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-white/80",children:"Advanced"}),e.jsxs("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{children:"Powered by"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Show small attribution"})]}),e.jsxs(T,{value:j.poweredBy||"false",onChange:t=>A(s=>({...s,poweredBy:t.target.value})),disabled:((l==null?void 0:l.id)||"free")==="free",children:[e.jsx("option",{value:"false",children:"hidden"}),e.jsx("option",{value:"true",children:"show"})]}),((l==null?void 0:l.id)||"free")==="free"&&e.jsx("div",{className:"text-xs text-white/50",children:"Required on Free plan"})]}),e.jsxs("div",{className:"grid gap-1 md:col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{children:"Webhook URL"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Receive render events"})]}),e.jsx(M,{placeholder:"https://example.com/webhook",value:j.webhookUrl||"",onChange:t=>A(s=>({...s,webhookUrl:t.target.value}))})]})]})]}),e.jsx("div",{className:"md:col-span-2 flex gap-2 justify-end",children:e.jsx(w,{disabled:g,onClick:async()=>{S(!0);try{const t={...j};(l==null?void 0:l.themeCustomization)!=="custom"&&delete t.brandColor,await fetch("/api/client/settings",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)}),_(null)}finally{S(!1)}},children:o("Save settings","Запази настройките")})})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Loading…"})}),Fe&&e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-xl rounded-xl border border-white/10 bg-neutral-950 p-4 text-white",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Edit embed"}),e.jsx("button",{className:"text-white/70",onClick:()=>ae(!1),children:"✕"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"ID"}),e.jsx(M,{value:f.id,disabled:!0})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Name"}),e.jsx(M,{value:f.name||"",onChange:t=>D(s=>({...s,name:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Vertical"}),e.jsxs(T,{value:f.vertical,onChange:t=>D(s=>({...s,vertical:t.target.value})),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Variant"}),e.jsxs(T,{value:f.variant,onChange:t=>D(s=>({...s,variant:t.target.value})),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Width"}),e.jsx(M,{value:f.width,onChange:t=>D(s=>({...s,width:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Height"}),e.jsx(M,{value:f.height,onChange:t=>D(s=>({...s,height:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Radius"}),e.jsx(M,{value:f.radius,onChange:t=>D(s=>({...s,radius:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Border"}),e.jsxs(T,{value:f.border,onChange:t=>D(s=>({...s,border:t.target.value})),children:[e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Shadow"}),e.jsxs(T,{value:f.shadow,onChange:t=>D(s=>({...s,shadow:t.target.value})),children:[e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]})]}),e.jsxs("div",{className:"mt-4 grid gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-white/70",children:"Live preview"}),e.jsx("iframe",{title:"edit-preview",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:"360px",border:"0",borderRadius:"10px",background:"#0b0d10"},ref:t=>{var x;if(!t)return;const s={attrs:{theme:f.theme||"dark",variant:f.variant||"card",width:f.width||"100%",height:f.height||"520px",radius:f.radius||"12px",border:f.border??"true",shadow:f.shadow??"true"}},n=oe(f.id,s,{vertical:f.vertical}),c=t.contentDocument||((x=t.contentWindow)==null?void 0:x.document);c&&(c.open(),c.write(`<!doctype html><html><body style="margin:0;background:#0b0d10">${n}</body></html>`),c.close())}})]}),e.jsxs("div",{className:"flex flex-col justify-end gap-2",children:[e.jsx(w,{onClick:async()=>{const t={...f};await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)}),ae(!1),V()},children:"Save changes"}),e.jsx(w,{variant:"subtle",onClick:()=>ae(!1),children:"Cancel"})]})]})]})}),e.jsx(ee,{title:o("Install your widget","Инсталирайте виджета"),children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_380px]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:o("Step 1 · Choose embed","Стъпка 1 · Изберете ембед")}),e.jsxs(T,{value:P||((Ne=h[0])==null?void 0:Ne.id)||"",onChange:t=>I(t.target.value),children:[h.map(t=>e.jsx("option",{value:t.id,children:t.id},t.id)),!h.length&&e.jsx("option",{value:"",children:o("No embeds yet","Няма ембеди")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:o("Step 2 · Pick a style","Стъпка 2 · Изберете стил")}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:q.map(t=>e.jsxs("button",{type:"button",onClick:()=>_e(t.id),className:`rounded-xl border px-4 py-3 text-left transition ${t.id===C?"border-white/60 bg-white/10 shadow-lg":"border-white/10 bg-black/20 hover:border-white/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold",children:[e.jsx("span",{children:t.name}),t.id===C&&e.jsx("span",{className:"text-xs text-emerald-300",children:o("Selected","Избрано")})]}),e.jsx("p",{className:"mt-1 text-xs text-white/70",children:t.subtitle})]},t.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:o("Step 3 · Copy & paste","Стъпка 3 · Копирайте и поставете")}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/30 p-3",children:[e.jsx("pre",{className:"max-h-48 overflow-auto whitespace-pre-wrap break-words text-xs text-white/80",children:Q}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(w,{onClick:()=>{navigator.clipboard.writeText(Q),W(o("Snippet copied","Кодът е копиран"))},children:o("Copy snippet","Копирай кода")}),e.jsx(w,{variant:"subtle",onClick:()=>he(Q),children:o("Refresh preview","Обнови прегледа")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:o("Suggested headline","Препоръчано заглавие")}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3 text-sm",children:[e.jsx("div",{className:"font-semibold text-white",children:(Se=b==null?void 0:b.copy)==null?void 0:Se.headline}),e.jsx("p",{className:"mt-1 text-white/70",children:(ke=b==null?void 0:b.copy)==null?void 0:ke.body}),e.jsx(w,{variant:"subtle",className:"mt-3",onClick:()=>{var s,n;const t=`${(s=b==null?void 0:b.copy)==null?void 0:s.headline}

${(n=b==null?void 0:b.copy)==null?void 0:n.body}`;navigator.clipboard.writeText(t),W(o("Copy text ready to paste","Текстът е копиран"))},children:o("Copy text","Копирай текста")})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/25 p-3",children:[e.jsx("iframe",{ref:de,title:"snippet-preview",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:((Ce=b==null?void 0:b.attrs)==null?void 0:Ce.height)||"520px",border:"0",borderRadius:"12px",background:(($e=b==null?void 0:b.preview)==null?void 0:$e.bg)||"#0b1120"}}),e.jsx("p",{className:"mt-2 text-xs text-white/60",children:o("Preview updates automatically. Paste the snippet anywhere on your site to launch the widget.","Прегледът се обновява автоматично. Поставете кода на сайта си, за да стартирате виджета.")})]})]})}),e.jsxs(ee,{title:"Usage",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(T,{value:H,onChange:t=>{me(t.target.value),ie(t.target.value)},children:h.map(t=>e.jsx("option",{value:t.id,children:t.id},t.id))}),e.jsx(w,{variant:"subtle",onClick:()=>ie(H),disabled:!H||pe,children:pe?"Loading…":"Refresh"})]}),xe.filter(t=>t&&t.event==="client_render").length===0?e.jsx("div",{className:"text-sm text-white/70",children:"No events yet."}):e.jsx("ul",{className:"space-y-1 text-xs",children:[...xe].filter(t=>t&&t.event==="client_render").sort((t,s)=>((s==null?void 0:s.ts)||0)-((t==null?void 0:t.ts)||0)).map(t=>e.jsxs("li",{className:"rounded border border-white/10 bg-black/20 p-2",children:[e.jsx("span",{className:"opacity-80",children:"render"})," · ",e.jsx("span",{className:"opacity-60",children:new Date(t.ts).toLocaleString(void 0,{timeZoneName:"short"})})]},t.id||t.ts))})]}),e.jsxs(ee,{title:"Stats & Usage",children:[e.jsx("div",{className:"mb-3 flex items-center gap-2",children:e.jsx(w,{variant:"subtle",onClick:ye,disabled:we,children:we?"Loading…":"Refresh stats"})}),d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4 lg:grid-cols-6",children:[e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Ee=d==null?void 0:d.totals)==null?void 0:Ee.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Generations"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Te=d==null?void 0:d.last24h)==null?void 0:Te.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Generations (24h)"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Be=d==null?void 0:d.clientTotals)==null?void 0:Be.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Client renders"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Le=d==null?void 0:d.clientLast24h)==null?void 0:Le.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Client renders (24h)"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Pe=d==null?void 0:d.plan)==null?void 0:Pe.monthlyGenerations)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Plan gens / mo"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:(d==null?void 0:d.monthlyUsed)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Used this month"})]})]}),e.jsx("div",{className:"mt-4 rounded-md border border-white/10 bg-black/30 p-3",children:(()=>{var c;const t=Number((d==null?void 0:d.monthlyUsed)||0),s=Number(((c=d==null?void 0:d.plan)==null?void 0:c.monthlyGenerations)||0)+Number((d==null?void 0:d.monthlyBonus)||0),n=s>0?Math.min(100,Math.round(t/s*100)):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs",children:[e.jsx("div",{className:"opacity-80",children:"Monthly generations"}),e.jsxs("div",{className:"opacity-70",children:[t," / ",s," ",d!=null&&d.monthlyBonus?`(+${d.monthlyBonus} bonus)`:""]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded bg-white/10",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 via-pink-500 to-cyan-400",style:{width:n+"%"}})}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center justify-between text-xs",children:[e.jsx("div",{className:"opacity-70",children:"$10 per extra 100 gens after limit"}),e.jsx(w,{className:"px-3 py-1",onClick:async()=>{if(window.__topupBusy)return;window.__topupBusy=!0;const x=event==null?void 0:event.currentTarget;x&&(x.disabled=!0);try{const $=await fetch("/api/billing/topup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({units:1})}),E=await $.json();if(!$.ok)throw new Error((E==null?void 0:E.error)||"Top-up failed");E!=null&&E.url&&(window.location.href=E.url)}catch(Z){alert(Z.message||"Top-up failed")}finally{window.__topupBusy=!1,x&&(x.disabled=!1)}},children:"Buy top-up"})]})]})})()})]}):e.jsx("div",{className:"text-sm text-white/70",children:"No stats yet."})]})]})]})}function Me(){const[a,r]=it();if(!a)return e.jsx(nt,{});const m=async()=>{try{await fetch("/api/client/me?action=logout",{method:"POST",headers:{Authorization:`Bearer ${a}`}})}catch{}r(""),window.location.href="/app/client.html"};return e.jsx(lt,{token:a,onSignOut:m})}class Oe extends Ie.Component{constructor(r){super(r),this.state={hasError:!1,message:""}}static getDerivedStateFromError(r){return{hasError:!0,message:(r==null?void 0:r.message)||""}}componentDidCatch(r,m){try{console.error("Client portal error",r,m)}catch{}}render(){return this.state.hasError?e.jsxs("div",{className:"p-6 text-red-400",children:["Failed to load portal. Please hard refresh. ",this.state.message?`(${this.state.message})`:""]}):this.props.children}}const le=()=>{const a=document.getElementById("root");a&&(Ke&&typeof Ue.createRoot=="function"?Ue.createRoot(a).render(e.jsx(Oe,{children:e.jsx(Me,{})})):ne&&typeof ne.render=="function"&&ne.render(e.jsx(Oe,{children:e.jsx(Me,{})}),a))};document.readyState==="loading"?(document.addEventListener("DOMContentLoaded",le,{once:!0}),setTimeout(le,1500)):le();(function(){if(new URLSearchParams(window.location.search).get("devtest")!=="1")return;const m=[],u=(v,L,B="")=>m.push({name:v,pass:!!L,detail:B}),h=oe("abc",{attrs:{theme:"light",wide:"true",radius:"18px"}});u("snippet has script tag",/^<script\s.+><\/script>$/.test(h)),u("includes data-embed-id",h.includes('data-embed-id="abc"')),u("includes theme",h.includes('data-theme="light"')),u("includes wide toggle",h.includes('data-wide="true"'));const y=new URL(window.location.href);y.searchParams.set("token","T_URL");const N=y.searchParams.get("token")==="T_URL";u("URLSearchParams working",N),console.table(m.map(v=>({test:v.name,pass:v.pass,detail:v.detail})))})();
