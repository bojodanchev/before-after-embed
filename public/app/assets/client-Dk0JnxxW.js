import{a as M,c as E,j as e,b as k,r as i}from"./client-CObCrlgQ.js";const z=()=>{const a=new URLSearchParams(window.location.search).get("token");if(a)return a;try{return localStorage.getItem("clientToken")||""}catch{return""}},$=t=>{try{localStorage.setItem("clientToken",t)}catch{}},F=()=>{try{localStorage.removeItem("clientToken")}catch{}};async function N(t){try{const a=await t.json();return(a==null?void 0:a.error)||(a==null?void 0:a.message)||`${t.status}`}catch{return`${t.status} ${t.statusText}`}}const P=(t,a,c)=>`<script ${["async",'src="https://before-after-embed.vercel.app/embed.js"',`data-embed-id="${t||"your-embed-id"}"`,`data-theme="${c}"`,`data-variant="${a}"`,'data-max-width="640px"','data-align="center"','data-radius="14px"','data-shadow="true"','data-border="true"','data-width="100%"','data-height="460px"'].join(" ")}><\/script>`,q=({className:t="",children:a})=>e.jsx("div",{className:`mx-auto w-full max-w-6xl px-4 sm:px-6 ${t}`,children:a}),L=({title:t,children:a})=>e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-6",children:[t&&e.jsx("h2",{className:"text-base font-semibold",children:t}),e.jsx("div",{className:t?"mt-3":"",children:a})]}),w=({variant:t="primary",className:a="",children:c,...n})=>{const o="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition",h={primary:"text-white bg-gradient-to-r from-violet-600 via-pink-500 to-cyan-400 hover:opacity-90 disabled:opacity-60",outline:"border border-white/20 bg-transparent text-white hover:bg-white/10",subtle:"bg-white/10 text-white hover:bg-white/20"};return e.jsx("button",{className:`${o} ${h[t]} ${a}`,...n,children:c})},b=t=>e.jsx("input",{...t,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white placeholder-white/50 focus:ring-2 focus:ring-violet-500"}),S=({children:t,...a})=>e.jsx("select",{...a,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white focus:ring-2 focus:ring-violet-500",children:t}),J=({children:t})=>e.jsx("code",{className:"rounded-md bg-black/40 px-1.5 py-0.5 text-[12px]",children:t});function _(){const[t,a]=i.useState("");return i.useEffect(()=>{const n=new URLSearchParams(window.location.search),o=n.get("token")||z();o&&(a(o),$(o),n.get("token")&&(n.delete("token"),window.history.replaceState({},"",window.location.pathname)))},[]),[t,n=>{a(n||""),n?$(n):F()}]}function H(){const[t,a]=i.useState(""),[c,n]=i.useState(!1),[o,h]=i.useState(""),[p,m]=i.useState(""),x=async u=>{u.preventDefault(),n(!0),h(""),m("");try{const r=await fetch("/api/client/me",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!r.ok)throw new Error(await N(r));const l=await r.json();if(l!=null&&l.link)window.location.href=l.link;else if(l!=null&&l.token){const g=new URL(window.location.href);g.searchParams.set("token",l.token),window.location.replace(g.toString())}else m("Sign-in link sent. Check your email.")}catch(r){h(typeof(r==null?void 0:r.message)=="string"?r.message:"Failed to send sign-in link")}finally{n(!1)}};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-neutral-950 text-white",children:e.jsxs("form",{onSubmit:x,className:"w-full max-w-sm rounded-xl border border-white/10 bg-white/5 p-6",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Client Portal Sign In"}),e.jsx(b,{type:"email",placeholder:"you@example.com",value:t,onChange:u=>a(u.target.value),required:!0}),e.jsx(w,{type:"submit",className:"mt-4 w-full",disabled:c,children:c?"Sending…":"Send sign-in link"}),!!o&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:o}),!!p&&e.jsx("p",{className:"mt-2 text-sm text-white/70",children:p})]})})}function W({token:t,onSignOut:a}){const[c,n]=i.useState(null),[o,h]=i.useState([]),[p,m]=i.useState(!0),[x,u]=i.useState(""),[r,l]=i.useState({id:"",vertical:"",theme:"dark"}),[g,A]=i.useState(""),[j,U]=i.useState("compact"),[v,B]=i.useState("dark"),C=i.useMemo(()=>P(g,j,v),[g,j,v]),T=async()=>{try{m(!0),u("");const s=await fetch("/api/client/me",{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error("Auth failed");const d=await s.json();n((d==null?void 0:d.client)||d);const y=await fetch("/api/client/embeds",{headers:{Authorization:`Bearer ${t}`}});if(!y.ok)throw new Error(await N(y));const f=await y.json(),D=Array.isArray(f)?f:(f==null?void 0:f.embeds)||[];h(D)}catch{u("Failed to load data")}finally{m(!1)}};i.useEffect(()=>{T()},[t]);const O=async s=>{s.preventDefault();try{const d=await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(r)});if(!d.ok)throw new Error(await N(d));l({id:"",vertical:"",theme:"dark"}),T()}catch(d){u(typeof(d==null?void 0:d.message)=="string"?d.message:"Failed to create embed")}};return p?e.jsx("div",{className:"p-6 text-white",children:"Loading…"}):x?e.jsx("div",{className:"p-6 text-red-400",children:x}):e.jsxs("div",{className:"min-h-screen bg-neutral-950 text-white",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-white/10 bg-neutral-950/80 backdrop-blur",children:e.jsxs(q,{className:"flex h-14 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-8 w-8 place-items-center rounded-xl bg-gradient-to-tr from-violet-500 via-pink-500 to-cyan-400 shadow",children:e.jsx("span",{className:"text-xs font-bold",children:"B/A"})}),e.jsx("div",{className:"text-sm font-semibold",children:"Before/After Portal"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[c&&e.jsxs("span",{children:[c.name," (",e.jsx(J,{children:c.id}),")"]}),e.jsx(w,{variant:"outline",onClick:a,children:"Sign out"})]})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl space-y-8 p-4",children:[e.jsxs(L,{title:"Embeds",children:[e.jsx("ul",{className:"space-y-2 text-sm",children:o.map(s=>e.jsxs("li",{className:"rounded-md border border-white/10 bg-black/20 p-2",children:[s.id," – ",s.vertical," – ",s.theme]},s.id))}),e.jsxs("form",{onSubmit:O,className:"mt-4 grid gap-2 md:grid-cols-3",children:[e.jsx(b,{placeholder:"id",value:r.id,onChange:s=>l({...r,id:s.target.value}),required:!0}),e.jsx(b,{placeholder:"vertical",value:r.vertical,onChange:s=>l({...r,vertical:s.target.value}),required:!0}),e.jsxs(S,{value:r.theme,onChange:s=>l({...r,theme:s.target.value}),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(w,{type:"submit",className:"md:col-span-3",children:"Create"})]})]}),e.jsxs(L,{title:"Snippet Builder",children:[e.jsxs("div",{className:"grid gap-2 md:grid-cols-3",children:[e.jsx(b,{placeholder:"embedId",value:g,onChange:s=>A(s.target.value)}),e.jsxs(S,{value:j,onChange:s=>U(s.target.value),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]}),e.jsxs(S,{value:v,onChange:s=>B(s.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]})]}),e.jsx("pre",{className:"mt-4 whitespace-pre-wrap break-words rounded-md bg-black/60 p-2 text-xs",children:C}),e.jsx(w,{className:"mt-2",onClick:()=>navigator.clipboard.writeText(C),children:"Copy snippet"})]})]})]})}function R(){const[t,a]=_();return t?e.jsx(W,{token:t,onSignOut:()=>{a(""),window.location.href="/app/client.html"}}):e.jsx(H,{})}const I=()=>{const t=document.getElementById("root");t&&(M&&typeof E.createRoot=="function"?E.createRoot(t).render(e.jsx(R,{})):k&&typeof k.render=="function"&&k.render(e.jsx(R,{}),t))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I,{once:!0}):I();(function(){if(new URLSearchParams(window.location.search).get("devtest")!=="1")return;const c=[],n=(m,x,u="")=>c.push({name:m,pass:!!x,detail:u}),o=P("abc","compact","dark");n("snippet has script tag",/^<script\s.+><\/script>$/.test(o)),n("includes data-embed-id",o.includes('data-embed-id="abc"')),n("includes variant",o.includes('data-variant="compact"')),n("includes theme",o.includes('data-theme="dark"'));const h=new URL(window.location.href);h.searchParams.set("token","T_URL");const p=h.searchParams.get("token")==="T_URL";n("URLSearchParams working",p),console.table(c.map(m=>({test:m.name,pass:m.pass,detail:m.detail})))})();
