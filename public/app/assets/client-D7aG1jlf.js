import{a as ee,c as H,j as e,b as $,r as i}from"./index-D67P2Q6G.js";const te=()=>{const a=new URLSearchParams(window.location.search).get("token");if(a)return a;try{return localStorage.getItem("clientToken")||""}catch{return""}},W=s=>{try{localStorage.setItem("clientToken",s)}catch{}},se=()=>{try{localStorage.removeItem("clientToken")}catch{}};async function y(s){try{const a=await s.json();return(a==null?void 0:a.error)||(a==null?void 0:a.message)||`${s.status}`}catch{return`${s.status} ${s.statusText}`}}const I=(s,a,d)=>`<script ${["async",'src="https://before-after-embed.vercel.app/embed.js"',`data-embed-id="${s||"your-embed-id"}"`,`data-theme="${d}"`,`data-variant="${a}"`,'data-max-width="640px"','data-align="center"','data-radius="14px"','data-shadow="true"','data-border="true"','data-width="100%"','data-height="460px"'].join(" ")}><\/script>`,ae=({className:s="",children:a})=>e.jsx("div",{className:`mx-auto w-full max-w-6xl px-4 sm:px-6 ${s}`,children:a}),C=({title:s,children:a})=>e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-6",children:[s&&e.jsx("h2",{className:"text-base font-semibold",children:s}),e.jsx("div",{className:s?"mt-3":"",children:a})]}),x=({variant:s="primary",className:a="",children:d,...r})=>{const l="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition",p={primary:"text-white bg-gradient-to-r from-violet-600 via-pink-500 to-cyan-400 hover:opacity-90 disabled:opacity-60",outline:"border border-white/20 bg-transparent text-white hover:bg-white/10",subtle:"bg-white/10 text-white hover:bg-white/20"};return e.jsx("button",{className:`${l} ${p[s]} ${a}`,...r,children:d})},U=s=>e.jsx("input",{...s,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white placeholder-white/50 focus:ring-2 focus:ring-violet-500"}),v=({children:s,...a})=>e.jsx("select",{...a,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white focus:ring-2 focus:ring-violet-500",children:s}),ne=({children:s})=>e.jsx("code",{className:"rounded-md bg-black/40 px-1.5 py-0.5 text-[12px]",children:s});function re(){const[s,a]=i.useState("");return i.useEffect(()=>{const r=new URLSearchParams(window.location.search),l=r.get("token")||te();l&&(a(l),W(l),r.get("token")&&(r.delete("token"),window.history.replaceState({},"",window.location.pathname)))},[]),[s,r=>{a(r||""),r?W(r):se()}]}function ie(){const[s,a]=i.useState(""),[d,r]=i.useState(!1),[l,p]=i.useState(""),[w,m]=i.useState(""),j=async u=>{u.preventDefault(),r(!0),p(""),m("");try{const o=await fetch("/api/client/me",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})});if(!o.ok)throw new Error(await y(o));const h=await o.json();if(h!=null&&h.link)window.location.href=h.link;else if(h!=null&&h.token){const g=new URL(window.location.href);g.searchParams.set("token",h.token),window.location.replace(g.toString())}else m("Sign-in link sent. Check your email.")}catch(o){p(typeof(o==null?void 0:o.message)=="string"?o.message:"Failed to send sign-in link")}finally{r(!1)}};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-neutral-950 text-white",children:e.jsxs("form",{onSubmit:j,className:"w-full max-w-sm rounded-xl border border-white/10 bg-white/5 p-6",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Client Portal Sign In"}),e.jsx(U,{type:"email",placeholder:"you@example.com",value:s,onChange:u=>a(u.target.value),required:!0}),e.jsx(x,{type:"submit",className:"mt-4 w-full",disabled:d,children:d?"Sending…":"Send sign-in link"}),!!l&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:l}),!!w&&e.jsx("p",{className:"mt-2 text-sm text-white/70",children:w})]})})}function oe({token:s,onSignOut:a}){var _,q;const[d,r]=i.useState(null),[l,p]=i.useState([]),[w,m]=i.useState(!0),[j,u]=i.useState(""),[o,h]=i.useState({id:"",vertical:"barber",theme:"dark"}),[g,E]=i.useState(""),[N,Q]=i.useState("compact"),[T,V]=i.useState("dark"),R=i.useMemo(()=>I(g,N,T),[g,N,T]),[S,A]=i.useState(""),[P,B]=i.useState([]),[O,z]=i.useState(!1),[f,D]=i.useState(null),[F,M]=i.useState(!1),L=async()=>{try{m(!0),u("");const t=await fetch("/api/client/me",{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error("Auth failed");const n=await t.json();r((n==null?void 0:n.client)||n);const c=await fetch("/api/client/embeds",{headers:{Authorization:`Bearer ${s}`}});if(!c.ok)throw new Error(await y(c));const b=await c.json(),k=Array.isArray(b)?b:(b==null?void 0:b.embeds)||[];p(k),!g&&k.length&&E(k[0].id),!S&&k.length&&A(k[0].id)}catch{u("Failed to load data")}finally{m(!1)}};i.useEffect(()=>{L()},[s]);const X=async t=>{t.preventDefault();try{const n=await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(o)});if(!n.ok)throw new Error(await y(n));h({id:"",vertical:o.vertical,theme:o.theme}),L()}catch(n){u(typeof(n==null?void 0:n.message)=="string"?n.message:"Failed to create embed")}},Y=async(t,n)=>{try{const c=await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({id:t,theme:n})});if(!c.ok)throw new Error(await y(c));L()}catch(c){u(typeof(c==null?void 0:c.message)=="string"?c.message:"Failed to update embed")}},J=async t=>{if(t){z(!0);try{const n=await fetch(`/api/client/usage?embedId=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${s}`}});if(!n.ok)throw new Error(await y(n));const c=await n.json(),b=Array.isArray(c)?c:(c==null?void 0:c.events)||[];B(b)}catch{B([])}finally{z(!1)}}},Z=async()=>{M(!0);try{const t=await fetch("/api/client/stats",{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error(await y(t));const n=await t.json();D(n||null)}catch{D(null)}finally{M(!1)}};return w?e.jsx("div",{className:"p-6 text-white",children:"Loading…"}):j?e.jsx("div",{className:"p-6 text-red-400",children:j}):e.jsxs("div",{className:"min-h-screen bg-neutral-950 text-white",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-white/10 bg-neutral-950/80 backdrop-blur",children:e.jsxs(ae,{className:"flex h-14 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-8 w-8 place-items-center rounded-xl bg-gradient-to-tr from-violet-500 via-pink-500 to-cyan-400 shadow",children:e.jsx("span",{className:"text-xs font-bold",children:"B/A"})}),e.jsx("div",{className:"text-sm font-semibold",children:"Before/After Portal"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[d&&e.jsxs("span",{children:[d.name," (",e.jsx(ne,{children:d.id}),")"]}),e.jsx(x,{variant:"outline",onClick:a,children:"Sign out"})]})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl space-y-8 p-4",children:[e.jsxs(C,{title:"Embeds",children:[e.jsx("ul",{className:"space-y-2 text-sm",children:l.map(t=>e.jsxs("li",{className:"flex flex-col gap-2 rounded-md border border-white/10 bg-black/20 p-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"truncate",children:[t.id," – ",t.vertical," – ",t.theme]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(v,{value:t.theme,onChange:n=>Y(t.id,n.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(x,{variant:"subtle",onClick:()=>E(t.id),children:"Use in Snippet"}),e.jsx(x,{variant:"outline",onClick:()=>navigator.clipboard.writeText(I(t.id,N,t.theme)),children:"Copy Snippet"}),e.jsx("a",{className:"text-xs underline",target:"_blank",rel:"noreferrer",href:`/widget.html?embedId=${encodeURIComponent(t.id)}&theme=${encodeURIComponent(t.theme)}`,children:"Open"})]})]},t.id))}),e.jsxs("form",{onSubmit:X,className:"mt-4 grid gap-2 md:grid-cols-4",children:[e.jsx(U,{placeholder:"id",value:o.id,onChange:t=>h({...o,id:t.target.value}),required:!0}),e.jsxs(v,{value:o.vertical,onChange:t=>h({...o,vertical:t.target.value}),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]}),e.jsxs(v,{value:o.theme,onChange:t=>h({...o,theme:t.target.value}),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(x,{type:"submit",className:"md:col-span-4",children:"Create"})]})]}),e.jsxs(C,{title:"Snippet Builder",children:[e.jsxs("div",{className:"grid gap-2 md:grid-cols-3",children:[e.jsx(U,{placeholder:"embedId",value:g,onChange:t=>E(t.target.value)}),e.jsxs(v,{value:N,onChange:t=>Q(t.target.value),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]}),e.jsxs(v,{value:T,onChange:t=>V(t.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]})]}),e.jsx("pre",{className:"mt-4 whitespace-pre-wrap break-words rounded-md bg-black/60 p-2 text-xs",children:R}),e.jsx(x,{className:"mt-2",onClick:()=>navigator.clipboard.writeText(R),children:"Copy snippet"})]}),e.jsxs(C,{title:"Usage",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(v,{value:S,onChange:t=>{A(t.target.value),J(t.target.value)},children:l.map(t=>e.jsx("option",{value:t.id,children:t.id},t.id))}),e.jsx(x,{variant:"subtle",onClick:()=>J(S),disabled:!S||O,children:O?"Loading…":"Refresh"})]}),P.length===0?e.jsx("div",{className:"text-sm text-white/70",children:"No events yet."}):e.jsx("ul",{className:"space-y-1 text-xs",children:P.map(t=>e.jsxs("li",{className:"rounded border border-white/10 bg-black/20 p-2",children:[e.jsx("span",{className:"opacity-80",children:t.event})," · ",e.jsx("span",{className:"opacity-60",children:new Date(t.ts).toLocaleString()})]},t.id||t.ts))})]}),e.jsxs(C,{title:"Stats (last 24h)",children:[e.jsx("div",{className:"mb-2",children:e.jsx(x,{variant:"subtle",onClick:Z,disabled:F,children:F?"Loading…":"Refresh stats"})}),f?e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((_=f==null?void 0:f.totals)==null?void 0:_.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Total events"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((q=f==null?void 0:f.last24h)==null?void 0:q.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Events (24h)"})]})]}):e.jsx("div",{className:"text-sm text-white/70",children:"No stats yet."})]})]})]})}function G(){const[s,a]=re();return s?e.jsx(oe,{token:s,onSignOut:()=>{a(""),window.location.href="/app/client.html"}}):e.jsx(ie,{})}const K=()=>{const s=document.getElementById("root");s&&(ee&&typeof H.createRoot=="function"?H.createRoot(s).render(e.jsx(G,{})):$&&typeof $.render=="function"&&$.render(e.jsx(G,{}),s))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",K,{once:!0}):K();(function(){if(new URLSearchParams(window.location.search).get("devtest")!=="1")return;const d=[],r=(m,j,u="")=>d.push({name:m,pass:!!j,detail:u}),l=I("abc","compact","dark");r("snippet has script tag",/^<script\s.+><\/script>$/.test(l)),r("includes data-embed-id",l.includes('data-embed-id="abc"')),r("includes variant",l.includes('data-variant="compact"')),r("includes theme",l.includes('data-theme="dark"'));const p=new URL(window.location.href);p.searchParams.set("token","T_URL");const w=p.searchParams.get("token")==="T_URL";r("URLSearchParams working",w),console.table(d.map(m=>({test:m.name,pass:m.pass,detail:m.detail})))})();
