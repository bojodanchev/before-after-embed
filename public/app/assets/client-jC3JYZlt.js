import{a as Le,c as je,j as e,b as X,r,R as Re}from"./index-K9Ecbp-m.js";const Ae=()=>{const l=new URLSearchParams(window.location.search).get("token");if(l)return l;try{return localStorage.getItem("clientToken")||""}catch{return""}},ye=s=>{try{localStorage.setItem("clientToken",s)}catch{}},Ue=()=>{try{localStorage.removeItem("clientToken")}catch{}};async function O(s){try{const l=await s.json();return(l==null?void 0:l.error)||(l==null?void 0:l.message)||`${s.status}`}catch{return`${s.status} ${s.statusText}`}}const Oe="https://before-after-embed.vercel.app/embed.js",z=(s,l,p,c={})=>{const u=Object.assign({},{maxWidth:"640px",align:"center",radius:"14px",shadow:"true",border:"true",width:"100%",height:"460px"},c);return`<script ${["async",`src="${Oe}"`,`data-embed-id="${s||"your-embed-id"}"`,`data-theme="${p}"`,`data-variant="${l}"`,...u.vertical?[`data-vertical="${u.vertical}"`]:[],`data-max-width="${u.maxWidth}"`,`data-align="${u.align}"`,`data-radius="${u.radius}"`,`data-shadow="${u.shadow}"`,`data-border="${u.border}"`,`data-width="${u.width}"`,`data-height="${u.height}"`].join(" ")}><\/script>`},ze=({className:s="",children:l})=>e.jsx("div",{className:`mx-auto w-full max-w-6xl px-4 sm:px-6 ${s}`,children:l}),A=({title:s,children:l})=>e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-6",children:[s&&e.jsx("h2",{className:"text-base font-semibold",children:s}),e.jsx("div",{className:s?"mt-3":"",children:l})]}),d=({variant:s="primary",className:l="",children:p,...c})=>{const g="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition",u={primary:"text-white bg-gradient-to-r from-violet-600 via-pink-500 to-cyan-400 hover:opacity-90 disabled:opacity-60",outline:"border border-white/20 bg-transparent text-white hover:bg-white/10",subtle:"bg-white/10 text-white hover:bg-white/20"};return e.jsx("button",{className:`${g} ${u[s]} ${l}`,...c,children:p})},f=s=>e.jsx("input",{...s,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white placeholder-white/50 focus:ring-2 focus:ring-violet-500"}),v=({children:s,...l})=>e.jsx("select",{...l,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white focus:ring-2 focus:ring-violet-500",children:s}),De=({children:s})=>e.jsx("code",{className:"rounded-md bg-black/40 px-1.5 py-0.5 text-[12px]",children:s}),U=({children:s})=>e.jsx("span",{className:"text-xs font-medium text-white/70",children:s});function Me(){const[s,l]=r.useState("");return r.useEffect(()=>{const c=new URLSearchParams(window.location.search),g=c.get("token")||Ae();g&&(l(g),ye(g),c.get("token")&&(c.delete("token"),window.history.replaceState({},"",window.location.pathname)))},[]),[s,c=>{l(c||""),c?ye(c):Ue()}]}function _e(){const[s,l]=r.useState(""),[p,c]=r.useState(!1),[g,u]=r.useState(""),[T,w]=r.useState(""),$=async()=>{c(!0),u(""),w("");try{const o=await fetch("/api/client/me",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})});if(!o.ok)throw new Error(await O(o));await o.json(),w("Sign-in link sent. Check your email.")}catch(o){u(typeof(o==null?void 0:o.message)=="string"?o.message:"Failed to send sign-in link")}finally{c(!1)}},k=async o=>{o.preventDefault(),p||$()};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-neutral-950 text-white",children:e.jsxs("form",{onSubmit:k,className:"w-full max-w-sm rounded-xl border border-white/10 bg-white/5 p-6",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Client Portal Sign In"}),e.jsx(f,{type:"email",placeholder:"you@example.com",value:s,onChange:o=>l(o.target.value),required:!0}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx(d,{type:"submit",className:"flex-1",disabled:p,children:p?"Sendingâ€¦":"Send link"}),e.jsx(d,{type:"button",variant:"subtle",disabled:p||!s,onClick:$,children:"Resend"})]}),!!g&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:g}),!!T&&e.jsx("p",{className:"mt-2 text-sm text-white/70",children:T})]})})}function We({token:s,onSignOut:l}){var ge,be,ve,we,fe;const[p,c]=r.useState(null),[g,u]=r.useState([]),[T,w]=r.useState(!0),[$,k]=r.useState(""),[o,_]=r.useState({id:"",vertical:"barber",theme:"dark"}),[W,H]=r.useState(""),[L,I]=r.useState("compact"),[q,Ce]=r.useState("dark"),[C,J]=r.useState({maxWidth:"640px",align:"center",radius:"14px",shadow:"true",border:"true",width:"100%",height:"460px"}),D=r.useMemo(()=>z(W,L,q,C),[W,L,q,C]),[F,V]=r.useState(""),Y=Re.useRef(null);r.useEffect(()=>{V(D)},[D]);const ee=t=>{var a;try{const i=Y.current;if(!i)return;const x=i.contentDocument||((a=i.contentWindow)==null?void 0:a.document);if(!x)return;const m=`<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/></head><body style="margin:0;background:${Z};display:flex;justify-content:${C.align==="center"?"center":"flex-start"};padding:16px">${t}</body></html>`;x.open(),x.write(m),x.close()}catch{}},[Z,Se]=r.useState("#0b0d10"),[te,ae]=r.useState("");r.useEffect(()=>{const t=setTimeout(()=>{try{ee(F),ae("")}catch{ae("Failed to render preview")}},300);return()=>clearTimeout(t)},[F,Z,C.align]);const[R,se]=r.useState(""),[ie,re]=r.useState([]),[ne,le]=r.useState(!1),[de,ce]=r.useState(""),[n,oe]=r.useState(null),[he,xe]=r.useState(!1),[S,E]=r.useState(null),[Te,me]=r.useState(!1),[h,$e]=r.useState(null),[Ee,G]=r.useState(!1),[b,y]=r.useState({id:"",name:"",vertical:"barber",theme:"dark",width:"100%",height:"520px",variant:"card",radius:"12px",shadow:"true",border:"true"}),P=async()=>{try{w(!0),k("");const t=await fetch("/api/client/me",{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error("Auth failed");const a=await t.json();c((a==null?void 0:a.client)||a);const i=await fetch("/api/client/embeds",{headers:{Authorization:`Bearer ${s}`}});if(!i.ok)throw new Error(await O(i));const x=await i.json(),m=Array.isArray(x)?x:(x==null?void 0:x.embeds)||[];u(m);try{const N=await(await fetch("/api/client/settings",{headers:{Authorization:`Bearer ${s}`}})).json();E((N==null?void 0:N.settings)||{}),$e((N==null?void 0:N.plan)||null)}catch{}!W&&m.length&&H(m[0].id),!R&&m.length&&se(m[0].id)}catch{k("Failed to load data")}finally{w(!1)}};r.useEffect(()=>{P()},[s]),r.useEffect(()=>{(async()=>{try{const t=new URLSearchParams(window.location.search),a=t.get("nextPlan");if(!a)return;t.delete("nextPlan");const i=new URL(window.location.href);i.search=t.toString(),window.history.replaceState({},"",i.toString());const x=await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({planId:a})}),m=await x.json();if(!x.ok)throw new Error((m==null?void 0:m.error)||"Checkout failed");m!=null&&m.url&&(window.location.href=m.url)}catch{}})()},[s]);const Pe=async t=>{t.preventDefault();try{const a=await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(o)});if(!a.ok)throw new Error(await O(a));_({id:"",vertical:o.vertical,theme:o.theme}),P()}catch(a){k(typeof(a==null?void 0:a.message)=="string"?a.message:"Failed to create embed")}},Be=async(t,a)=>{try{const i=await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({id:t,theme:a})});if(!i.ok)throw new Error(await O(i));P()}catch(i){k(typeof(i==null?void 0:i.message)=="string"?i.message:"Failed to update embed")}},K=async t=>{if(t){le(!0);try{const a=await fetch(`/api/client/usage?embedId=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${s}`}});if(!a.ok)throw new Error(await O(a));const i=await a.json(),x=Array.isArray(i)?i:(i==null?void 0:i.events)||[];re(x)}catch{re([])}finally{le(!1)}}},ue=async()=>{xe(!0);try{const t=await fetch("/api/client/stats",{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error(await O(t));const a=await t.json();oe(a||null)}catch{oe(null)}finally{xe(!1)}};if(r.useEffect(()=>{const t=new URLSearchParams(window.location.search);if(t.get("success")==="1"){const a=t.get("topup")||t.get("plan")?t.get("topup")?`+${t.get("topup")} generations`:"Plan updated":"Success";ce(`${a} ðŸŽ‰`),setTimeout(()=>ce(""),3e3),t.delete("success"),t.delete("topup"),t.delete("plan");const i=new URL(window.location.href);i.search=t.toString(),window.history.replaceState({},"",i.toString()),ue(),R&&K(R)}},[]),T)return e.jsx("div",{className:"p-6 text-white",children:"Loadingâ€¦"});if($)return e.jsx("div",{className:"p-6 text-red-400",children:$});const[M,pe]=r.useState(()=>{try{return localStorage.getItem("lang")||"en"}catch{return"en"}});r.useEffect(()=>{try{localStorage.setItem("lang",M)}catch{}},[M]);const j=(t,a)=>M==="bg"?a:t;return e.jsxs("div",{className:"min-h-screen bg-neutral-950 text-white",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-white/10 bg-neutral-950/80 backdrop-blur",children:e.jsxs(ze,{className:"flex h-14 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-8 w-8 place-items-center rounded-xl bg-gradient-to-tr from-violet-500 via-pink-500 to-cyan-400 shadow",children:e.jsx("span",{className:"text-xs font-bold",children:"B/A"})}),e.jsx("div",{className:"text-sm font-semibold",children:j("Before/After Portal","ÐŸÐ¾Ñ€Ñ‚Ð°Ð» Before/After")})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[p&&e.jsxs("span",{children:[p.name," (",e.jsx(De,{children:p.id}),")"]}),e.jsx(d,{variant:"outline",onClick:l,children:j("Sign out","Ð˜Ð·Ñ…Ð¾Ð´")}),e.jsxs("div",{className:"inline-flex items-center rounded-md border border-white/20 bg-white/5 p-0.5",children:[e.jsx("button",{onClick:()=>pe("en"),className:`${M==="en"?"bg-white/20 text-white":"text-white/80"} rounded px-2 py-1 text-xs`,children:"EN"}),e.jsx("button",{onClick:()=>pe("bg"),className:`${M==="bg"?"bg-white/20 text-white":"text-white/80"} rounded px-2 py-1 text-xs`,children:"BG"})]})]})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl space-y-8 p-4",children:[!!de&&e.jsx("div",{className:"fixed right-4 top-16 z-50 rounded-lg border border-emerald-400/30 bg-emerald-500/15 px-3 py-2 text-sm text-emerald-300 shadow-lg",children:de}),e.jsxs(A,{title:j("Embeds","Ð•Ð¼Ð±ÐµÐ´Ð¾Ð²Ðµ"),children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between rounded-md border border-white/10 bg-black/30 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"opacity-70",children:j("Current plan","Ð¢ÐµÐºÑƒÑ‰ Ð¿Ð»Ð°Ð½")}),e.jsx("div",{className:"font-medium",children:(h==null?void 0:h.name)||(h==null?void 0:h.id)||"free"})]}),e.jsx("div",{className:"rounded border border-white/10 bg-black/40 px-2 py-1 text-xs opacity-80",children:(()=>{const t=((h==null?void 0:h.id)||"free")==="free";return`${j("Watermark","Ð’Ð¾Ð´ÐµÐ½ Ð·Ð½Ð°Ðº")}: ${t?j("active","Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½"):j("removed","Ð¿Ñ€ÐµÐ¼Ð°Ñ…Ð½Ð°Ñ‚")}`})()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-xs opacity-70",children:[(h==null?void 0:h.monthlyGenerations)??0," ",j("gens / mo","Ð³ÐµÐ½./Ð¼ÐµÑÐµÑ†")]}),e.jsx("a",{href:"/app/pricing.html",className:"underline",children:j("Change plan","ÐŸÑ€Ð¾Ð¼ÑÐ½Ð° Ð½Ð° Ð¿Ð»Ð°Ð½")}),e.jsx("button",{className:"rounded-md border border-white/20 bg-white/10 px-2 py-1 text-xs hover:bg-white/20",onClick:async()=>{try{const t=await fetch("/api/billing/topup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({units:1})}),a=await t.json();if(!t.ok)throw new Error((a==null?void 0:a.error)||"Top-up failed");a!=null&&a.url&&(window.location.href=a.url)}catch(t){alert(t.message||"Top-up failed")}},children:j("Buy +100","ÐšÑƒÐ¿Ð¸ +100")})]})]}),e.jsx("ul",{className:"space-y-2 text-sm",children:g.map(t=>e.jsxs("li",{className:"flex flex-col gap-2 rounded-md border border-white/10 bg-black/20 p-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"truncate",children:[t.id," â€“ ",t.vertical," â€“ ",t.theme]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(v,{value:t.theme,onChange:a=>Be(t.id,a.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(d,{variant:"outline",onClick:()=>{y({...t,variant:t.variant||"card",radius:t.radius||"12px",shadow:t.shadow??"true",border:t.border??"true"}),G(!0)},children:"Edit"}),e.jsx(d,{variant:"outline",onClick:async()=>{const a=`${t.id}-copy`;await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({...t,id:a,name:t.name||a})}),P()},children:"Duplicate"}),e.jsx(d,{variant:"outline",onClick:async()=>{if(!confirm(`Delete embed ${t.id}?`))return;const a=new URL("/api/client/embeds",location.origin);a.searchParams.set("id",t.id),await fetch(a.toString(),{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),P()},children:"Delete"}),e.jsxs("details",{className:"ml-2",children:[e.jsx("summary",{className:"cursor-pointer rounded-md border border-white/20 bg-white/10 px-3 py-1 text-xs text-white/80",children:"More"}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsx(d,{variant:"subtle",onClick:()=>H(t.id),children:"Use in Snippet"}),e.jsx(d,{variant:"outline",onClick:()=>navigator.clipboard.writeText(z(t.id,L,t.theme)),children:"Copy Current"}),e.jsx(d,{variant:"outline",onClick:()=>navigator.clipboard.writeText(z(t.id,L,"light")),children:"Copy Light"}),e.jsx(d,{variant:"outline",onClick:()=>navigator.clipboard.writeText(z(t.id,L,"dark")),children:"Copy Dark"}),e.jsxs(d,{variant:"outline",onClick:async()=>{const a=t.theme==="dark"?"light":"dark",i=`${t.id}-${a}`;await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({...t,id:i,theme:a,name:t.name?`${t.name} (${a})`:i})}),P()},children:["Duplicate to "," ",t.theme==="dark"?"light":"dark"]})]})]})]})]},t.id))}),e.jsxs("form",{onSubmit:Pe,className:"mt-4 grid gap-2 md:grid-cols-4",children:[e.jsx(f,{placeholder:"id",value:o.id,onChange:t=>_({...o,id:t.target.value}),required:!0}),e.jsxs(v,{value:o.vertical,onChange:t=>_({...o,vertical:t.target.value}),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]}),e.jsxs(v,{value:o.theme,onChange:t=>_({...o,theme:t.target.value}),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(d,{type:"submit",className:"md:col-span-4",children:"Create"})]})]}),e.jsx(A,{title:"Client settings",children:S?e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Display name"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Shown only in your portal"})]}),e.jsx(f,{value:S.displayName||"",onChange:t=>E(a=>({...a,displayName:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Brand color"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Tint buttons and active chips"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{value:S.brandColor||"#7c3aed",onChange:t=>E(a=>({...a,brandColor:t.target.value})),disabled:!h||h.themeCustomization!=="custom"}),(!h||h.themeCustomization!=="custom")&&e.jsx("span",{className:"text-xs text-white/50",children:"Growth/Pro only"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Default theme"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Light or dark for new embeds"})]}),e.jsxs(v,{value:S.defaultTheme||"dark",onChange:t=>E(a=>({...a,defaultTheme:t.target.value})),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Default variant"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Compact (inline) or Card (iframe)"})]}),e.jsxs(v,{value:S.defaultVariant||"card",onChange:t=>E(a=>({...a,defaultVariant:t.target.value})),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]})]}),e.jsxs("details",{className:"md:col-span-2 rounded-md border border-white/10 bg-black/30 p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-white/80",children:"Advanced"}),e.jsxs("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Powered by"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Show small attribution"})]}),e.jsxs(v,{value:S.poweredBy||"false",onChange:t=>E(a=>({...a,poweredBy:t.target.value})),disabled:((h==null?void 0:h.id)||"free")==="free",children:[e.jsx("option",{value:"false",children:"hidden"}),e.jsx("option",{value:"true",children:"show"})]}),((h==null?void 0:h.id)||"free")==="free"&&e.jsx("div",{className:"text-xs text-white/50",children:"Required on Free plan"})]}),e.jsxs("div",{className:"grid gap-1 md:col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Webhook URL"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Receive render events"})]}),e.jsx(f,{placeholder:"https://example.com/webhook",value:S.webhookUrl||"",onChange:t=>E(a=>({...a,webhookUrl:t.target.value}))})]})]})]}),e.jsx("div",{className:"md:col-span-2 flex gap-2 justify-end",children:e.jsx(d,{disabled:Te,onClick:async()=>{me(!0);try{await fetch("/api/client/settings",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(S)})}finally{me(!1)}},children:"Save settings"})})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Loadingâ€¦"})}),Ee&&e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-xl rounded-xl border border-white/10 bg-neutral-950 p-4 text-white",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Edit embed"}),e.jsx("button",{className:"text-white/70",onClick:()=>G(!1),children:"âœ•"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"ID"}),e.jsx(f,{value:b.id,disabled:!0})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Name"}),e.jsx(f,{value:b.name||"",onChange:t=>y(a=>({...a,name:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Vertical"}),e.jsxs(v,{value:b.vertical,onChange:t=>y(a=>({...a,vertical:t.target.value})),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Variant"}),e.jsxs(v,{value:b.variant,onChange:t=>y(a=>({...a,variant:t.target.value})),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Width"}),e.jsx(f,{value:b.width,onChange:t=>y(a=>({...a,width:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Height"}),e.jsx(f,{value:b.height,onChange:t=>y(a=>({...a,height:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Radius"}),e.jsx(f,{value:b.radius,onChange:t=>y(a=>({...a,radius:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Border"}),e.jsxs(v,{value:b.border,onChange:t=>y(a=>({...a,border:t.target.value})),children:[e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Shadow"}),e.jsxs(v,{value:b.shadow,onChange:t=>y(a=>({...a,shadow:t.target.value})),children:[e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]})]}),e.jsxs("div",{className:"mt-4 grid gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-white/70",children:"Live preview"}),e.jsx("iframe",{title:"edit-preview",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:"360px",border:"0",borderRadius:"10px",background:"#0b0d10"},ref:t=>{var x;if(!t)return;const a=z(b.id,b.variant,b.theme||"dark",{vertical:b.vertical}).replace('data-width="100%"','data-width="'+(b.width||"100%")+'"').replace('data-height="460px"','data-height="'+(b.height||"520px")+'"'),i=t.contentDocument||((x=t.contentWindow)==null?void 0:x.document);i&&(i.open(),i.write(`<!doctype html><html><body style="margin:0;background:#0b0d10">${a}</body></html>`),i.close())}})]}),e.jsxs("div",{className:"flex flex-col justify-end gap-2",children:[e.jsx(d,{onClick:async()=>{const t={...b};await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(t)}),G(!1),P()},children:"Save changes"}),e.jsx(d,{variant:"subtle",onClick:()=>G(!1),children:"Cancel"})]})]})]})}),e.jsxs(A,{title:"Snippet Builder",children:[e.jsxs("div",{className:"grid gap-2 md:grid-cols-3",children:[e.jsx(f,{placeholder:"embedId",value:W,onChange:t=>H(t.target.value)}),e.jsxs(v,{value:L,onChange:t=>I(t.target.value),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]}),e.jsxs(v,{value:q,onChange:t=>Ce(t.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]})]}),e.jsxs("div",{className:"mt-2 grid gap-2 md:grid-cols-3",children:[e.jsx(d,{variant:"subtle",onClick:()=>{I("compact"),J({...C,maxWidth:"640px",align:"center",radius:"14px",width:"100%",height:"460px"})},children:"Preset: Compact"}),e.jsx(d,{variant:"subtle",onClick:()=>{I("card"),J({...C,maxWidth:"980px",align:"left",radius:"12px",width:"100%",height:"520px"})},children:"Preset: Card"}),e.jsx(d,{variant:"subtle",onClick:()=>{I("card"),J({...C,maxWidth:"100%",align:"center",radius:"0px",width:"100%",height:"600px",border:"false",shadow:"false"})},children:"Preset: Fullâ€‘bleed"})]}),e.jsx("pre",{className:"mt-4 whitespace-pre-wrap break-words rounded-md bg-black/60 p-2 text-xs",children:D}),e.jsx("div",{className:"mt-2 text-xs text-white/70",children:"Preview is a raw HTML page containing only your snippetâ€”identical to what a client site will execute."}),e.jsx(d,{className:"mt-2",onClick:()=>navigator.clipboard.writeText(D),children:"Copy snippet"})]}),e.jsx(A,{title:"Live Snippet Preview (iframe sandbox)",children:e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("textarea",{value:F,onChange:t=>V(t.target.value),rows:10,className:"w-full rounded-md border border-white/10 bg-black/40 p-2 text-xs font-mono"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx(d,{variant:"subtle",onClick:()=>V(D),children:"Reset to builder"}),e.jsx(d,{onClick:()=>ee(F),children:"Run preview"}),e.jsxs(v,{value:Z,onChange:t=>Se(t.target.value),children:[e.jsx("option",{value:"#0b0d10",children:"dark page"}),e.jsx("option",{value:"#ffffff",children:"white page"}),e.jsx("option",{value:"#f1f5f9",children:"light grey"})]}),e.jsxs(v,{value:C.align,onChange:t=>J(a=>({...a,align:t.target.value})),children:[e.jsx("option",{value:"center",children:"center"}),e.jsx("option",{value:"left",children:"left"})]})]}),!!te&&e.jsx("div",{className:"mt-2 rounded-md border border-red-500/40 bg-red-500/10 p-2 text-xs text-red-300",children:te})]}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-black/20 p-2",children:e.jsx("iframe",{ref:Y,title:"snippet-preview",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:"520px",border:"0",borderRadius:"10px",background:"#0b0d10"}})})]})}),e.jsxs(A,{title:"Usage",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(v,{value:R,onChange:t=>{se(t.target.value),K(t.target.value)},children:g.map(t=>e.jsx("option",{value:t.id,children:t.id},t.id))}),e.jsx(d,{variant:"subtle",onClick:()=>K(R),disabled:!R||ne,children:ne?"Loadingâ€¦":"Refresh"})]}),ie.filter(t=>t&&t.event==="client_render").length===0?e.jsx("div",{className:"text-sm text-white/70",children:"No events yet."}):e.jsx("ul",{className:"space-y-1 text-xs",children:[...ie].filter(t=>t&&t.event==="client_render").sort((t,a)=>((a==null?void 0:a.ts)||0)-((t==null?void 0:t.ts)||0)).map(t=>e.jsxs("li",{className:"rounded border border-white/10 bg-black/20 p-2",children:[e.jsx("span",{className:"opacity-80",children:"render"})," Â· ",e.jsx("span",{className:"opacity-60",children:new Date(t.ts).toLocaleString(void 0,{timeZoneName:"short"})})]},t.id||t.ts))})]}),e.jsxs(A,{title:"Stats & Usage",children:[e.jsx("div",{className:"mb-3 flex items-center gap-2",children:e.jsx(d,{variant:"subtle",onClick:ue,disabled:he,children:he?"Loadingâ€¦":"Refresh stats"})}),n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4 lg:grid-cols-6",children:[e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((ge=n==null?void 0:n.totals)==null?void 0:ge.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Generations"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((be=n==null?void 0:n.last24h)==null?void 0:be.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Generations (24h)"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((ve=n==null?void 0:n.clientTotals)==null?void 0:ve.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Client renders"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((we=n==null?void 0:n.clientLast24h)==null?void 0:we.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Client renders (24h)"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((fe=n==null?void 0:n.plan)==null?void 0:fe.monthlyGenerations)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Plan gens / mo"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:(n==null?void 0:n.monthlyUsed)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Used this month"})]})]}),e.jsx("div",{className:"mt-4 rounded-md border border-white/10 bg-black/30 p-3",children:(()=>{var x;const t=Number((n==null?void 0:n.monthlyUsed)||0),a=Number(((x=n==null?void 0:n.plan)==null?void 0:x.monthlyGenerations)||0)+Number((n==null?void 0:n.monthlyBonus)||0),i=a>0?Math.min(100,Math.round(t/a*100)):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs",children:[e.jsx("div",{className:"opacity-80",children:"Monthly generations"}),e.jsxs("div",{className:"opacity-70",children:[t," / ",a," ",n!=null&&n.monthlyBonus?`(+${n.monthlyBonus} bonus)`:""]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded bg-white/10",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 via-pink-500 to-cyan-400",style:{width:i+"%"}})}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center justify-between text-xs",children:[e.jsx("div",{className:"opacity-70",children:"$10 per extra 100 gens after limit"}),e.jsx(d,{className:"px-3 py-1",onClick:async()=>{if(window.__topupBusy)return;window.__topupBusy=!0;const m=event==null?void 0:event.currentTarget;m&&(m.disabled=!0);try{const N=await fetch("/api/billing/topup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({units:1})}),B=await N.json();if(!N.ok)throw new Error((B==null?void 0:B.error)||"Top-up failed");B!=null&&B.url&&(window.location.href=B.url)}catch(Q){alert(Q.message||"Top-up failed")}finally{window.__topupBusy=!1,m&&(m.disabled=!1)}},children:"Buy top-up"})]})]})})()})]}):e.jsx("div",{className:"text-sm text-white/70",children:"No stats yet."})]})]})]})}function Ne(){const[s,l]=Me();if(!s)return e.jsx(_e,{});const p=async()=>{try{await fetch("/api/client/me?action=logout",{method:"POST",headers:{Authorization:`Bearer ${s}`}})}catch{}l(""),window.location.href="/app/client.html"};return e.jsx(We,{token:s,onSignOut:p})}const ke=()=>{const s=document.getElementById("root");s&&(Le&&typeof je.createRoot=="function"?je.createRoot(s).render(e.jsx(Ne,{})):X&&typeof X.render=="function"&&X.render(e.jsx(Ne,{}),s))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ke,{once:!0}):ke();(function(){if(new URLSearchParams(window.location.search).get("devtest")!=="1")return;const p=[],c=(w,$,k="")=>p.push({name:w,pass:!!$,detail:k}),g=z("abc","compact","dark");c("snippet has script tag",/^<script\s.+><\/script>$/.test(g)),c("includes data-embed-id",g.includes('data-embed-id="abc"')),c("includes variant",g.includes('data-variant="compact"')),c("includes theme",g.includes('data-theme="dark"'));const u=new URL(window.location.href);u.searchParams.set("token","T_URL");const T=u.searchParams.get("token")==="T_URL";c("URLSearchParams working",T),console.table(p.map(w=>({test:w.name,pass:w.pass,detail:w.detail})))})();
