import{R as qe,j as e,a as at,c as ze,b as he,r}from"./index-BRQHBgdZ.js";const it=()=>{const i=new URLSearchParams(window.location.search).get("token");if(i)return i;try{return localStorage.getItem("clientToken")||""}catch{return""}},Fe=a=>{try{localStorage.setItem("clientToken",a)}catch{}},rt=()=>{try{localStorage.removeItem("clientToken")}catch{}};async function X(a){try{const i=await a.json();return(i==null?void 0:i.error)||(i==null?void 0:i.message)||`${a.status}`}catch{return`${a.status} ${a.statusText}`}}const nt="https://before-after-embed.vercel.app/embed.js",lt=a=>a.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`),me=(a,i={},m={})=>{const u={embedId:a||"your-embed-id",..."attrs"in i?i.attrs:i,...m},c=["async",`src="${nt}"`];return Object.entries(u).forEach(([j,y])=>{if(y==null||y==="")return;const v=`data-${lt(j.replace(/^data-/,""))}`;c.push(`${v}="${String(y)}"`)}),`<script ${c.join(" ")}><\/script>`},ot=[{id:"light",name:"Light",subtitle:"Bright card for white backgrounds",attrs:{theme:"light",wide:"true",border:"true",shadow:"false",radius:"18px",align:"center",height:"520px"},preview:{bg:"#f8fafc",fg:"#0f172a"},copy:{headline:"Show the transformation instantly",body:"Upload, generate, and drag the slider so customers see the clean finish before booking."}},{id:"dark",name:"Dark",subtitle:"Glassmorphism card for dark sites",attrs:{theme:"dark",wide:"true",border:"true",shadow:"true",radius:"20px",align:"center",height:"520px"},preview:{bg:"#0b1120",fg:"#f8fafc"},copy:{headline:"Bring the shine forward",body:"Let visitors preview your AI enhancements without leaving the page."}},{id:"brand",name:"Brand color",subtitle:"Uses your accent color for buttons and pills",attrs:{theme:"light",wide:"true",border:"true",shadow:"true",radius:"18px",align:"center",height:"520px"},preview:{bg:"#ffffff",fg:"#0f172a"},copy:{headline:"Spotlight your signature look",body:"Buttons, pills, and slider accents inherit your brand color automatically."}},{id:"minimal",name:"Minimal",subtitle:"Compact embed for sidebars and narrow sections",attrs:{theme:"auto",wide:"false",border:"false",shadow:"false",radius:"8px",align:"left",height:"420px"},preview:{bg:"#f1f5f9",fg:"#111827"},copy:{headline:"Drop into any sidebar",body:"The compact layout keeps controls stacked for a quick install."}}],dt=({className:a="",children:i})=>e.jsx("div",{className:`mx-auto w-full max-w-6xl px-4 sm:px-6 ${a}`,children:i}),se=({title:a,children:i})=>e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-6",children:[a&&e.jsx("h2",{className:"text-base font-semibold",children:a}),e.jsx("div",{className:a?"mt-3":"",children:i})]}),w=({variant:a="primary",className:i="",children:m,...u})=>{const c="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition",j={primary:"text-white bg-gradient-to-r from-violet-600 via-pink-500 to-cyan-400 hover:opacity-90 disabled:opacity-60",outline:"border border-white/20 bg-transparent text-white hover:bg-white/10",subtle:"bg-white/10 text-white hover:bg-white/20"};return e.jsx("button",{className:`${c} ${j[a]} ${i}`,...u,children:m})},O=a=>e.jsx("input",{...a,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white placeholder-white/50 focus:ring-2 focus:ring-violet-500"}),P=({children:a,...i})=>e.jsx("select",{...i,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white focus:ring-2 focus:ring-violet-500",children:a}),ct=({children:a})=>e.jsx("code",{className:"rounded-md bg-black/40 px-1.5 py-0.5 text-[12px]",children:a}),U=({children:a})=>e.jsx("span",{className:"text-xs font-medium text-white/70",children:a}),Ge=["#f97316","#6366f1","#22d3ee","#ef4444","#10b981","#fbbf24"],ht=({step:a,total:i})=>e.jsx("div",{className:"flex items-center justify-center gap-2 text-xs text-white/60",children:Array.from({length:i}).map((m,u)=>e.jsx("span",{className:`h-2 w-2 rounded-full ${u+1<=a?"bg-white":"bg-white/20"}`},u))}),xt=({t:a,canCustomize:i,brandColor:m,onApply:u,onPreview:c,setToast:j})=>{const y=i?Ge.length:2,v=r.useRef(null),[C,$]=r.useState(!1),[n,E]=r.useState(null);r.useEffect(()=>{E(null)},[i]);const A=(g,k)=>{g&&(k&&!i?(c(g),E(g),j(a("Previewing premium color â€” upgrade to save","ÐŸÑ€ÐµÐ³Ð»ÐµÐ´ Ð½Ð° Ð¿Ñ€ÐµÐ¼Ð¸ÑƒÐ¼ Ñ†Ð²ÑÑ‚ â€” ÑŠÐ¿Ð³Ñ€ÐµÐ¹Ð´ Ð·Ð° Ð·Ð°Ð¿Ð¸Ñ"))):(c(null),u(g),E(null)))},ae=(g,k)=>{const d=!i&&k>=y;A(g,d)},o=()=>{var g;(g=v.current)==null||g.click()},N=g=>new Promise((k,d)=>{const B=new FileReader;B.onload=()=>{const ee=new Image;ee.onload=()=>{try{const J=document.createElement("canvas"),W=48;J.width=W,J.height=W;const ie=J.getContext("2d");ie.drawImage(ee,0,0,W,W);const R=ie.getImageData(0,0,W,W).data;let I=0,K=0,_=0,z=R.length/4;for(let T=0;T<R.length;T+=4)I+=R[T],K+=R[T+1],_+=R[T+2];I=Math.round(I/z),K=Math.round(K/z),_=Math.round(_/z);const Z=`#${[I,K,_].map(T=>T.toString(16).padStart(2,"0")).join("")}`;k(Z)}catch(J){d(J)}},ee.onerror=d,ee.src=B.result},B.onerror=d,B.readAsDataURL(g)}),D=async g=>{var d;const k=(d=g.target.files)==null?void 0:d[0];if(g.target.value="",!!k){$(!0);try{const B=await N(k);A(B,!i)}catch{j(a("Could not read that logo. Try another image.","ÐÐµÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¸Ð·Ð²Ð»Ð¸Ñ‡Ð°Ð½Ðµ Ð¾Ñ‚ Ð»Ð¾Ð³Ð¾Ñ‚Ð¾. ÐžÐ¿Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ Ð´Ñ€ÑƒÐ³ Ñ„Ð°Ð¹Ð»."))}finally{$(!1)}}};return e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:a("Brand color","Ð‘Ñ€Ð°Ð½Ð´ Ñ†Ð²ÑÑ‚")}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:a("Tint buttons and active chips","ÐÐºÑ†ÐµÐ½Ñ‚Ð¸Ñ€Ð°Ð½ Ñ†Ð²ÑÑ‚")}),!i&&e.jsx("span",{className:"text-xs text-white/50",children:a("Upgrade for more","ÐªÐ¿Ð³Ñ€ÐµÐ¹Ð´ Ð·Ð° Ð¿Ð¾Ð²ÐµÑ‡Ðµ")})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[Ge.map((g,k)=>{const d=(m==null?void 0:m.toLowerCase())===g.toLowerCase()||n===g,B=!i&&k>=y;return e.jsx("button",{type:"button",className:`h-8 w-8 rounded-full border transition ${d?"border-white":"border-white/10"} ${B?"opacity-50":""}`,style:{background:g},onClick:()=>ae(g,k),"aria-label":`Accent ${g}${B?" (locked)":""}`},g)}),e.jsx("button",{type:"button",onClick:o,className:"inline-flex items-center gap-1 rounded-full border border-white/20 bg-white/10 px-3 py-1 text-xs text-white hover:bg-white/20",disabled:C,children:C?a("Detectingâ€¦","Ð˜Ð·Ð²Ð»Ð¸Ñ‡Ð°Ð½Ðµâ€¦"):a("Match logo","Ð¦Ð²ÑÑ‚ Ð¾Ñ‚ Ð»Ð¾Ð³Ð¾")}),e.jsx("input",{ref:v,type:"file",accept:"image/*",className:"hidden",onChange:D}),i&&e.jsx("input",{type:"color",value:m,onChange:g=>A(g.target.value,!1),className:"h-8 w-12 cursor-pointer rounded border border-white/20 bg-transparent","aria-label":"Custom color"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/60",children:[e.jsxs("span",{children:[a("Current accent","Ð¢ÐµÐºÑƒÑ‰ Ð°ÐºÑ†ÐµÐ½Ñ‚"),": ",m]}),n&&!i&&e.jsx("span",{className:"rounded bg-white/10 px-2 py-0.5 text-[10px] text-amber-300",children:a("Preview only â€¢ upgrade to apply","Ð¡Ð°Ð¼Ð¾ Ð¿Ñ€ÐµÐ³Ð»ÐµÐ´ â€¢ ÑŠÐ¿Ð³Ñ€ÐµÐ¹Ð´ Ð·Ð° Ð·Ð°Ð¿Ð¸Ñ")})]})]})},mt=({open:a,step:i,placement:m,snippet:u,onClose:c,onCopy:j,onNext:y,onPrev:v,onPlacement:C,onPreview:$,t:n})=>{if(!a)return null;const E=3;return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/70 px-4",children:e.jsxs("div",{className:"w-full max-w-xl rounded-2xl border border-white/10 bg-neutral-950 p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:n("Guided setup","Ð ÑŠÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð·Ð° Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°")}),e.jsx("p",{className:"mt-1 text-xs text-white/60",children:n("Follow the steps to embed Before/After in under a minute.","Ð¡Ð»ÐµÐ´Ð²Ð°Ð¹Ñ‚Ðµ ÑÑ‚ÑŠÐ¿ÐºÐ¸Ñ‚Ðµ, Ð·Ð° Ð´Ð° Ð²Ð³Ñ€Ð°Ð´Ð¸Ñ‚Ðµ Before/After Ð·Ð° Ð¿Ð¾-Ð¼Ð°Ð»ÐºÐ¾ Ð¾Ñ‚ Ð¼Ð¸Ð½ÑƒÑ‚Ð°.")})]}),e.jsx("button",{onClick:c,className:"rounded-full border border-white/20 bg-white/10 px-2 py-1 text-sm text-white/60 hover:bg-white/20",children:"âœ•"})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs uppercase tracking-wide text-white/40",children:[n("Step","Ð¡Ñ‚ÑŠÐ¿ÐºÐ°")," ",i," / ",E]}),e.jsx(ht,{step:i,total:E})]}),e.jsxs("div",{className:"mt-4 space-y-4 text-sm text-white",children:[i===1&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:n("Copy the embed script and paste it anywhere on your site where you want the widget to appear.","ÐšÐ¾Ð¿Ð¸Ñ€Ð°Ð¹Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° Ð¸ Ð³Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð²ÐµÑ‚Ðµ Ð½Ð° ÑÐ°Ð¹Ñ‚Ð° ÑÐ¸ Ñ‚Ð°Ð¼, ÐºÑŠÐ´ÐµÑ‚Ð¾ Ð¸ÑÐºÐ°Ñ‚Ðµ Ð´Ð° ÑÐµ Ð¿Ð¾ÑÐ²Ð¸ Ð²Ð¸Ð´Ð¶ÐµÑ‚ÑŠÑ‚.")}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/40 p-3 text-xs text-white/80",children:[e.jsx("pre",{className:"max-h-48 overflow-auto whitespace-pre-wrap break-words",children:u}),e.jsx(w,{className:"mt-3",onClick:j,children:n("Copy script","ÐšÐ¾Ð¿Ð¸Ñ€Ð°Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°")})]})]}),i===2&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:n("Where will it sit on the page? Choose a layout and weâ€™ll tailor the embed automatically.","ÐšÑŠÐ´Ðµ Ñ‰Ðµ ÑÑ‚Ð¾Ð¸ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð°Ñ‚Ð°? Ð˜Ð·Ð±ÐµÑ€ÐµÑ‚Ðµ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¸ Ñ‰Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ð¼ ÐµÐ¼Ð±ÐµÐ´Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾.")}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("button",{type:"button",onClick:()=>C("wide"),className:`rounded-xl border px-4 py-3 text-left transition ${m==="wide"?"border-white bg-white/10 shadow-lg":"border-white/10 bg-black/30 hover:border-white/30"}`,children:[e.jsx("div",{className:"text-sm font-semibold",children:n("Full-width section","ÐŸÑŠÐ»Ð½Ð° ÑˆÐ¸Ñ€Ð¸Ð½Ð°")}),e.jsx("p",{className:"mt-1 text-xs text-white/70",children:n("Best for hero or feature sections.","ÐŸÐ¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð¾ Ð·Ð° Ñ…ÐµÑ€Ð¾ Ð¸Ð»Ð¸ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¸ ÑÐµÐºÑ†Ð¸Ð¸.")})]}),e.jsxs("button",{type:"button",onClick:()=>C("sidebar"),className:`rounded-xl border px-4 py-3 text-left transition ${m==="sidebar"?"border-white bg-white/10 shadow-lg":"border-white/10 bg-black/30 hover:border-white/30"}`,children:[e.jsx("div",{className:"text-sm font-semibold",children:n("Sidebar or narrow column","Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ‡Ð½Ð° ÐºÐ¾Ð»Ð¾Ð½Ð°")}),e.jsx("p",{className:"mt-1 text-xs text-white/70",children:n("Keeps everything stacked in a compact panel.","ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚ÐµÐ½ Ð¿Ð°Ð½ÐµÐ» Ð·Ð° Ñ‚ÐµÑÐ½Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð°.")})]})]})]}),i===3&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:n("Open a staging preview to test the widget before you paste it live.","ÐžÑ‚Ð²Ð¾Ñ€ÐµÑ‚Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð² Ð¿Ñ€ÐµÐ³Ð»ÐµÐ´, Ð·Ð° Ð´Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð¸Ð´Ð¶ÐµÑ‚Ð° Ð¿Ñ€ÐµÐ´Ð¸ Ð´Ð° Ð³Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚Ðµ Ð½Ð° Ð¶Ð¸Ð²Ð¾.")}),e.jsx(w,{onClick:$,children:n("Open test drive","ÐžÑ‚Ð²Ð¾Ñ€Ð¸ Ñ‚ÐµÑÑ‚Ð¾Ð² Ð¿Ñ€ÐµÐ³Ð»ÐµÐ´")}),e.jsx("p",{className:"text-xs text-white/60",children:n("The preview opens in a new tab with your current settings.","ÐŸÑ€ÐµÐ³Ð»ÐµÐ´ÑŠÑ‚ ÑÐµ Ð¾Ñ‚Ð²Ð°Ñ€Ñ Ð² Ð½Ð¾Ð² Ñ€Ð°Ð·Ð´ÐµÐ» Ñ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ñ‚Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸.")})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsx(w,{variant:"subtle",onClick:i===1?c:v,children:i===1?n("Close","Ð—Ð°Ñ‚Ð²Ð¾Ñ€Ð¸"):n("Back","ÐÐ°Ð·Ð°Ð´")}),e.jsx(w,{onClick:i===E?c:y,children:i===E?n("Done","Ð“Ð¾Ñ‚Ð¾Ð²Ð¾"):n("Next","Ð¡Ð»ÐµÐ´Ð²Ð°Ñ‰Ð°")})]})]})})};function ut(){const[a,i]=r.useState("");return r.useEffect(()=>{const u=new URLSearchParams(window.location.search),c=u.get("token")||it();c&&(i(c),Fe(c),u.get("token")&&(u.delete("token"),window.history.replaceState({},"",window.location.pathname)))},[]),[a,u=>{i(u||""),u?Fe(u):rt()}]}function pt(){const[a,i]=r.useState(""),[m,u]=r.useState(!1),[c,j]=r.useState(""),[y,v]=r.useState(""),C=async()=>{u(!0),j(""),v("");try{const n=await fetch("/api/client/me",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})});if(!n.ok)throw new Error(await X(n));await n.json(),v("Sign-in link sent. Check your email.")}catch(n){j(typeof(n==null?void 0:n.message)=="string"?n.message:"Failed to send sign-in link")}finally{u(!1)}},$=async n=>{n.preventDefault(),m||C()};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-neutral-950 text-white",children:e.jsxs("form",{onSubmit:$,className:"w-full max-w-sm rounded-xl border border-white/10 bg-white/5 p-6",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Client Portal Sign In"}),e.jsx(O,{type:"email",placeholder:"you@example.com",value:a,onChange:n=>i(n.target.value),required:!0}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx(w,{type:"submit",className:"flex-1",disabled:m,children:m?"Sendingâ€¦":"Send link"}),e.jsx(w,{type:"button",variant:"subtle",disabled:m||!a,onClick:C,children:"Resend"})]}),!!c&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:c}),!!y&&e.jsx("p",{className:"mt-2 text-sm text-white/70",children:y})]})})}function gt({token:a,onSignOut:i}){var Te,Le,Pe,Re,Ue,Ae,De,Me,Oe,Ie;const[m,u]=r.useState(null),[c,j]=r.useState([]),[y,v]=r.useState(!0),[C,$]=r.useState(""),[n,E]=r.useState({id:"",vertical:"barber",theme:"dark"}),[A,ae]=r.useState(()=>{try{return localStorage.getItem("lang")||"en"}catch{return"en"}});r.useEffect(()=>{try{localStorage.setItem("lang",A)}catch{}},[A]);const o=(t,s)=>A==="bg"?s:t,[N,D]=r.useState(null),[g,k]=r.useState(!1),[d,B]=r.useState(null),[ee,J]=r.useState(0),[W,ie]=r.useState(0),[R,I]=r.useState(""),[K,_]=r.useState(null),z=K||(N==null?void 0:N.brandColor)||"#f97316",Z=r.useMemo(()=>ot.map(t=>t.id==="brand"?{...t,attrs:{...t.attrs,brandColor:z},preview:{...t.preview,accent:z}}:t),[z]),[T,le]=r.useState("light"),b=r.useMemo(()=>Z.find(t=>t.id===T)||Z[0],[Z,T]),q=r.useMemo(()=>{var l,h;const t=R||((l=c[0])==null?void 0:l.id)||"your-embed-id",s=(h=c.find(p=>p.id===t))==null?void 0:h.vertical;return me(t,b||{},s?{vertical:s}:{})},[R,c,b]),ue=qe.useRef(null),pe=(t="")=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ge=t=>{var s,l,h,p,F,S;try{const L=ue.current;if(!L)return;const V=L.contentDocument||((s=L.contentWindow)==null?void 0:s.document);if(!V)return;const G=b||{},ne=((l=G.preview)==null?void 0:l.bg)||"#0b1120",Xe=((h=G.preview)==null?void 0:h.fg)||"#f8fafc",_e=((p=G.attrs)==null?void 0:p.align)==="left"?"flex-start":"center",et=pe(((F=G.copy)==null?void 0:F.headline)||"Before & After preview"),tt=pe(((S=G.copy)==null?void 0:S.body)||"Upload, generate, and drag the slider to compare results."),st=`<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/></head><body style="margin:0;background:${ne};color:${Xe};font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;display:flex;flex-direction:column;gap:16px;align-items:${_e};padding:32px 24px;"><div style="max-width:680px;text-align:${_e==="center"?"center":"left"}"><h2 style="margin:0;font-size:22px;font-weight:600;">${et}</h2><p style="margin:8px 0 0;font-size:14px;opacity:0.78;">${tt}</p></div>${t}</body></html>`;V.open(),V.write(st),V.close()}catch{}};r.useEffect(()=>{const t=setTimeout(()=>ge(q),200);return()=>clearTimeout(t)},[q,b]),r.useEffect(()=>{_(null)},[N==null?void 0:N.brandColor]),r.useEffect(()=>{const t=new URLSearchParams(window.location.search);if(t.get("showInstaller")==="1"){de(!0),t.delete("showInstaller");const s=new URL(window.location.href);s.search=t.toString(),window.history.replaceState({},"",s.toString())}},[]);const[Y,be]=r.useState(""),[we,fe]=r.useState([]),[ve,je]=r.useState(!1),[ye,H]=r.useState(""),[x,Ne]=r.useState(null),[Se,ke]=r.useState(!1),[oe,de]=r.useState(!1),[He,te]=r.useState(1),[Ce,Ve]=r.useState("wide");r.useEffect(()=>{oe&&Ee(Ce)},[oe]);const $e=async()=>{try{await navigator.clipboard.writeText(q),H(o("Snippet copied","ÐšÐ¾Ð´ÑŠÑ‚ Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð°Ð½"))}catch{H(o("Copy failed. Select and copy manually.","ÐšÐ¾Ð¿Ð¸Ñ€Ð°Ð½ÐµÑ‚Ð¾ Ð½ÐµÑƒÑÐ¿ÐµÑˆÐ½Ð¾. Ð˜Ð·Ð±ÐµÑ€ÐµÑ‚Ðµ Ð¸ ÐºÐ¾Ð¿Ð¸Ñ€Ð°Ð¹Ñ‚Ðµ Ñ€ÑŠÑ‡Ð½Ð¾."))}},Ee=t=>{Ve(t),t==="sidebar"?le("minimal"):t==="wide"&&T==="minimal"&&le("light"),te(s=>s===2?3:s)},Ke=()=>{var V,G,ne;const t=b||{},s=((V=t.preview)==null?void 0:V.bg)||"#0b1120",l=((G=t.preview)==null?void 0:G.fg)||"#f8fafc",h=((ne=t.attrs)==null?void 0:ne.align)==="left"?"flex-start":"center",p=`<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/></head><body style="margin:0;background:${s};color:${l};font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;display:flex;flex-direction:column;gap:24px;align-items:${h};padding:48px 32px;">
      <h1 style="margin:0;font-size:24px;font-weight:600;">Before/After Test Drive</h1>
      <p style="margin:0;font-size:14px;opacity:0.75;max-width:640px;">Paste this embed on your site to recreate the experience below.</p>
      ${q}
    </body></html>`,F=new Blob([p],{type:"text/html"}),S=URL.createObjectURL(F);window.open(S,"_blank","noopener")&&setTimeout(()=>URL.revokeObjectURL(S),1e4)},[Ze,re]=r.useState(!1),[f,M]=r.useState({id:"",name:"",vertical:"barber",theme:"dark",width:"100%",height:"520px",variant:"card",radius:"12px",shadow:"true",border:"true"}),Q=async()=>{try{v(!0),$("");const t=await fetch("/api/client/me",{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Auth failed");const s=await t.json();u((s==null?void 0:s.client)||s);const l=await fetch("/api/client/embeds",{headers:{Authorization:`Bearer ${a}`}});if(!l.ok)throw new Error(await X(l));const h=await l.json(),p=Array.isArray(h)?h:(h==null?void 0:h.embeds)||[];j(p);try{const S=await(await fetch("/api/client/settings",{headers:{Authorization:`Bearer ${a}`}})).json();D((S==null?void 0:S.settings)||{}),B((S==null?void 0:S.plan)||null)}catch{}!R&&p.length&&I(p[0].id),!Y&&p.length&&be(p[0].id)}catch{$("Failed to load data")}finally{v(!1)}};r.useEffect(()=>{Q()},[a]),r.useEffect(()=>{(async()=>{try{const t=new URLSearchParams(window.location.search),s=t.get("nextPlan");if(!s)return;t.delete("nextPlan");const l=new URL(window.location.href);l.search=t.toString(),window.history.replaceState({},"",l.toString());const h=await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({planId:s})}),p=await h.json();if(!h.ok)throw new Error((p==null?void 0:p.error)||"Checkout failed");p!=null&&p.url&&(window.location.href=p.url)}catch{}})()},[a]);const Ye=async t=>{t.preventDefault();try{const s=await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(n)});if(!s.ok)throw new Error(await X(s));E({id:"",vertical:n.vertical,theme:n.theme}),Q()}catch(s){$(typeof(s==null?void 0:s.message)=="string"?s.message:"Failed to create embed")}},Qe=async(t,s)=>{try{const l=await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({id:t,theme:s})});if(!l.ok)throw new Error(await X(l));Q()}catch(l){$(typeof(l==null?void 0:l.message)=="string"?l.message:"Failed to update embed")}},ce=async t=>{if(t){je(!0);try{const s=await fetch(`/api/client/stats?embedId=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${a}`}});if(!s.ok)throw new Error(await X(s));const l=await s.json(),h=Array.isArray(l)?l:(l==null?void 0:l.events)||[];fe(h)}catch{fe([])}finally{je(!1)}}},Be=async()=>{ke(!0);try{const t=await fetch("/api/client/stats",{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error(await X(t));const s=await t.json();Ne(s||null);try{const l=await fetch("/api/client/stats",{headers:{Authorization:`Bearer ${a}`}}),h=await l.json();if(!l.ok)throw new Error((h==null?void 0:h.error)||"Failed");B(h.plan||null),J(Number(h.monthlyUsed||0)),ie(Number(h.monthlyBonus||0))}catch{}}catch{Ne(null)}finally{ke(!1)}};return r.useEffect(()=>{const t=new URLSearchParams(window.location.search);if(t.get("success")==="1"){const s=t.get("topup")||t.get("plan")?t.get("topup")?`+${t.get("topup")} generations`:"Plan updated":"Success";H(`${s} ðŸŽ‰`),setTimeout(()=>H(""),3e3),t.delete("success"),t.delete("topup"),t.delete("plan");const l=new URL(window.location.href);l.search=t.toString(),window.history.replaceState({},"",l.toString()),Be(),Y&&ce(Y)}},[]),y?e.jsx("div",{className:"p-6 text-white",children:"Loadingâ€¦"}):C?e.jsx("div",{className:"p-6 text-red-400",children:C}):e.jsxs("div",{className:"min-h-screen bg-neutral-950 text-white",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-white/10 bg-neutral-950/80 backdrop-blur",children:e.jsxs(dt,{className:"flex h-14 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-8 w-8 place-items-center rounded-xl bg-gradient-to-tr from-violet-500 via-pink-500 to-cyan-400 shadow",children:e.jsx("span",{className:"text-xs font-bold",children:"B/A"})}),e.jsx("div",{className:"text-sm font-semibold",children:o("Before/After Portal","ÐŸÐ¾Ñ€Ñ‚Ð°Ð» Before/After")})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[m&&e.jsxs("span",{children:[m.name," (",e.jsx(ct,{children:m.id}),")"]}),e.jsx(w,{variant:"outline",onClick:i,children:o("Sign out","Ð˜Ð·Ñ…Ð¾Ð´")}),e.jsxs("div",{className:"inline-flex items-center rounded-md border border-white/20 bg-white/5 p-0.5",children:[e.jsx("button",{onClick:()=>ae("en"),className:`${A==="en"?"bg-white/20 text-white":"text-white/80"} rounded px-2 py-1 text-xs`,children:"EN"}),e.jsx("button",{onClick:()=>ae("bg"),className:`${A==="bg"?"bg-white/20 text-white":"text-white/80"} rounded px-2 py-1 text-xs`,children:"BG"})]})]})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl space-y-8 p-4",children:[!!ye&&e.jsx("div",{className:"fixed right-4 top-16 z-50 rounded-lg border border-emerald-400/30 bg-emerald-500/15 px-3 py-2 text-sm text-emerald-300 shadow-lg",children:ye}),!c.length&&e.jsxs("div",{className:"rounded-xl border border-white/10 bg-amber-500/10 p-4 text-sm text-amber-100",children:[o("New here? Use the guided setup to embed your widget in three quick steps.","Ð—Ð° Ð¿ÑŠÑ€Ð²Ð¸ Ð¿ÑŠÑ‚ ÑÑ‚Ðµ Ñ‚ÑƒÐº? ÐŸÑƒÑÐ½ÐµÑ‚Ðµ Ñ€ÑŠÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾Ñ‚Ð¾ Ð·Ð° Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð² Ñ‚Ñ€Ð¸ ÑÑ‚ÑŠÐ¿ÐºÐ¸."),e.jsx(w,{className:"ml-3",variant:"subtle",onClick:()=>{te(1),de(!0)},children:o("Start guided setup","Ð¡Ñ‚Ð°Ñ€Ñ‚Ð¸Ñ€Ð°Ð¹Ñ‚Ðµ Ñ€ÑŠÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾Ñ‚Ð¾")})]}),e.jsxs(se,{title:o("Embeds","Ð•Ð¼Ð±ÐµÐ´Ð¾Ð²Ðµ"),children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between rounded-md border border-white/10 bg-black/30 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"opacity-70",children:o("Current plan","Ð¢ÐµÐºÑƒÑ‰ Ð¿Ð»Ð°Ð½")}),e.jsx("div",{className:"font-medium",children:(d==null?void 0:d.name)||(d==null?void 0:d.id)||"free"})]}),e.jsx("div",{className:"rounded border border-white/10 bg-black/40 px-2 py-1 text-xs opacity-80",children:(()=>{const t=((d==null?void 0:d.id)||"free")==="free";return`${o("Watermark","Ð’Ð¾Ð´ÐµÐ½ Ð·Ð½Ð°Ðº")}: ${t?o("active","Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½"):o("removed","Ð¿Ñ€ÐµÐ¼Ð°Ñ…Ð½Ð°Ñ‚")}`})()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-xs opacity-70",children:[(d==null?void 0:d.monthlyGenerations)??0," ",o("gens / mo","Ð³ÐµÐ½./Ð¼ÐµÑÐµÑ†")]}),e.jsx("a",{href:"/app/pricing.html",className:"underline",children:o("Change plan","ÐŸÑ€Ð¾Ð¼ÑÐ½Ð° Ð½Ð° Ð¿Ð»Ð°Ð½")}),e.jsx("button",{className:"rounded-md border border-white/20 bg-white/10 px-2 py-1 text-xs hover:bg-white/20",onClick:async()=>{try{const t=await fetch("/api/billing/topup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({units:1})}),s=await t.json();if(!t.ok)throw new Error((s==null?void 0:s.error)||"Top-up failed");s!=null&&s.url&&(window.location.href=s.url)}catch(t){alert(t.message||"Top-up failed")}},children:o("Buy +100","ÐšÑƒÐ¿Ð¸ +100")})]})]}),e.jsx("ul",{className:"space-y-2 text-sm",children:c.map(t=>e.jsxs("li",{className:"flex flex-col gap-2 rounded-md border border-white/10 bg-black/20 p-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"truncate",children:[t.id," â€“ ",t.vertical," â€“ ",t.theme]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(P,{value:t.theme,onChange:s=>Qe(t.id,s.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(w,{variant:"outline",onClick:()=>{I(t.id),H(`${o("Snippet builder now uses","Ð¡Ð½Ð¸Ð¿ÐµÑ‚ÑŠÑ‚ Ð²ÐµÑ‡Ðµ Ð¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°")} ${t.id}`)},children:"Use in builder"}),e.jsx(w,{variant:"outline",onClick:()=>{M({...t,variant:t.variant||"card",radius:t.radius||"12px",shadow:t.shadow??"true",border:t.border??"true"}),re(!0)},children:o("Edit","Ð ÐµÐ´Ð°ÐºÑ†Ð¸Ñ")}),e.jsx(w,{variant:"outline",onClick:async()=>{const s=`${t.id}-copy`;await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({...t,id:s,name:t.name||s})}),Q()},children:o("Duplicate","Ð”ÑƒÐ±Ð»Ð¸Ñ€Ð°Ð¹")}),e.jsx(w,{variant:"outline",onClick:async()=>{if(!confirm(`Delete embed ${t.id}?`))return;const s=new URL("/api/client/embeds",location.origin);s.searchParams.set("id",t.id),await fetch(s.toString(),{method:"DELETE",headers:{Authorization:`Bearer ${a}`}}),Q()},children:o("Delete","Ð˜Ð·Ñ‚Ñ€Ð¸Ð¹")})]})]},t.id))}),e.jsxs("form",{onSubmit:Ye,className:"mt-4 grid gap-2 md:grid-cols-4",children:[e.jsx(O,{placeholder:"id",value:n.id,onChange:t=>E({...n,id:t.target.value}),required:!0}),e.jsxs(P,{value:n.vertical,onChange:t=>E({...n,vertical:t.target.value}),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]}),e.jsxs(P,{value:n.theme,onChange:t=>E({...n,theme:t.target.value}),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(w,{type:"submit",className:"md:col-span-4",children:"Create"})]})]}),e.jsx(se,{title:"Client settings",children:N?e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Display name"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Shown only in your portal"})]}),e.jsx(O,{value:N.displayName||"",onChange:t=>D(s=>({...s,displayName:t.target.value}))})]}),e.jsx(xt,{t:o,canCustomize:(d==null?void 0:d.themeCustomization)==="custom",brandColor:z,onPreview:t=>_(t),onApply:t=>D(s=>({...s,brandColor:t})),setToast:H}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Default theme"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Light or dark for new embeds"})]}),e.jsxs(P,{value:N.defaultTheme||"dark",onChange:t=>D(s=>({...s,defaultTheme:t.target.value})),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Default variant"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Compact (inline) or Card (iframe)"})]}),e.jsxs(P,{value:N.defaultVariant||"card",onChange:t=>D(s=>({...s,defaultVariant:t.target.value})),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]})]}),e.jsxs("details",{className:"md:col-span-2 rounded-md border border-white/10 bg-black/30 p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-white/80",children:"Advanced"}),e.jsxs("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Powered by"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Show small attribution"})]}),e.jsxs(P,{value:N.poweredBy||"false",onChange:t=>D(s=>({...s,poweredBy:t.target.value})),disabled:((d==null?void 0:d.id)||"free")==="free",children:[e.jsx("option",{value:"false",children:"hidden"}),e.jsx("option",{value:"true",children:"show"})]}),((d==null?void 0:d.id)||"free")==="free"&&e.jsx("div",{className:"text-xs text-white/50",children:"Required on Free plan"})]}),e.jsxs("div",{className:"grid gap-1 md:col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{children:"Webhook URL"}),e.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[10px] text-white/70",children:"Receive render events"})]}),e.jsx(O,{placeholder:"https://example.com/webhook",value:N.webhookUrl||"",onChange:t=>D(s=>({...s,webhookUrl:t.target.value}))})]})]})]}),e.jsx("div",{className:"md:col-span-2 flex gap-2 justify-end",children:e.jsx(w,{disabled:g,onClick:async()=>{k(!0);try{const t={...N};(d==null?void 0:d.themeCustomization)!=="custom"&&delete t.brandColor,await fetch("/api/client/settings",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)}),_(null)}finally{k(!1)}},children:o("Save settings","Ð—Ð°Ð¿Ð°Ð·Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸Ñ‚Ðµ")})})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Loadingâ€¦"})}),Ze&&e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-xl rounded-xl border border-white/10 bg-neutral-950 p-4 text-white",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Edit embed"}),e.jsx("button",{className:"text-white/70",onClick:()=>re(!1),children:"âœ•"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"ID"}),e.jsx(O,{value:f.id,disabled:!0})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Name"}),e.jsx(O,{value:f.name||"",onChange:t=>M(s=>({...s,name:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Vertical"}),e.jsxs(P,{value:f.vertical,onChange:t=>M(s=>({...s,vertical:t.target.value})),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Variant"}),e.jsxs(P,{value:f.variant,onChange:t=>M(s=>({...s,variant:t.target.value})),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Width"}),e.jsx(O,{value:f.width,onChange:t=>M(s=>({...s,width:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Height"}),e.jsx(O,{value:f.height,onChange:t=>M(s=>({...s,height:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Radius"}),e.jsx(O,{value:f.radius,onChange:t=>M(s=>({...s,radius:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Border"}),e.jsxs(P,{value:f.border,onChange:t=>M(s=>({...s,border:t.target.value})),children:[e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Shadow"}),e.jsxs(P,{value:f.shadow,onChange:t=>M(s=>({...s,shadow:t.target.value})),children:[e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]})]}),e.jsxs("div",{className:"mt-4 grid gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-white/70",children:"Live preview"}),e.jsx("iframe",{title:"edit-preview",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:"360px",border:"0",borderRadius:"10px",background:"#0b0d10"},ref:t=>{var p;if(!t)return;const s={attrs:{theme:f.theme||"dark",variant:f.variant||"card",width:f.width||"100%",height:f.height||"520px",radius:f.radius||"12px",border:f.border??"true",shadow:f.shadow??"true"}},l=me(f.id,s,{vertical:f.vertical}),h=t.contentDocument||((p=t.contentWindow)==null?void 0:p.document);h&&(h.open(),h.write(`<!doctype html><html><body style="margin:0;background:#0b0d10">${l}</body></html>`),h.close())}})]}),e.jsxs("div",{className:"flex flex-col justify-end gap-2",children:[e.jsx(w,{onClick:async()=>{const t={...f};await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)}),re(!1),Q()},children:"Save changes"}),e.jsx(w,{variant:"subtle",onClick:()=>re(!1),children:"Cancel"})]})]})]})}),e.jsx(se,{title:o("Install your widget","Ð˜Ð½ÑÑ‚Ð°Ð»Ð¸Ñ€Ð°Ð¹Ñ‚Ðµ Ð²Ð¸Ð´Ð¶ÐµÑ‚Ð°"),children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_380px]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:o("Step 1 Â· Choose embed","Ð¡Ñ‚ÑŠÐ¿ÐºÐ° 1 Â· Ð˜Ð·Ð±ÐµÑ€ÐµÑ‚Ðµ ÐµÐ¼Ð±ÐµÐ´")}),e.jsxs(P,{value:R||((Te=c[0])==null?void 0:Te.id)||"",onChange:t=>I(t.target.value),children:[c.map(t=>e.jsx("option",{value:t.id,children:t.id},t.id)),!c.length&&e.jsx("option",{value:"",children:o("No embeds yet","ÐÑÐ¼Ð° ÐµÐ¼Ð±ÐµÐ´Ð¸")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:o("Step 2 Â· Pick a style","Ð¡Ñ‚ÑŠÐ¿ÐºÐ° 2 Â· Ð˜Ð·Ð±ÐµÑ€ÐµÑ‚Ðµ ÑÑ‚Ð¸Ð»")}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:Z.map(t=>e.jsxs("button",{type:"button",onClick:()=>le(t.id),className:`rounded-xl border px-4 py-3 text-left transition ${t.id===T?"border-white/60 bg-white/10 shadow-lg":"border-white/10 bg-black/20 hover:border-white/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold",children:[e.jsx("span",{children:t.name}),t.id===T&&e.jsx("span",{className:"text-xs text-emerald-300",children:o("Selected","Ð˜Ð·Ð±Ñ€Ð°Ð½Ð¾")})]}),e.jsx("p",{className:"mt-1 text-xs text-white/70",children:t.subtitle})]},t.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:o("Step 3 Â· Copy & paste","Ð¡Ñ‚ÑŠÐ¿ÐºÐ° 3 Â· ÐšÐ¾Ð¿Ð¸Ñ€Ð°Ð¹Ñ‚Ðµ Ð¸ Ð¿Ð¾ÑÑ‚Ð°Ð²ÐµÑ‚Ðµ")}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/30 p-3",children:[e.jsx("pre",{className:"max-h-48 overflow-auto whitespace-pre-wrap break-words text-xs text-white/80",children:q}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(w,{onClick:$e,children:o("Copy snippet","ÐšÐ¾Ð¿Ð¸Ñ€Ð°Ð¹ ÐºÐ¾Ð´Ð°")}),e.jsx(w,{variant:"subtle",onClick:()=>ge(q),children:o("Refresh preview","ÐžÐ±Ð½Ð¾Ð²Ð¸ Ð¿Ñ€ÐµÐ³Ð»ÐµÐ´Ð°")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:o("Suggested headline","ÐŸÑ€ÐµÐ¿Ð¾Ñ€ÑŠÑ‡Ð°Ð½Ð¾ Ð·Ð°Ð³Ð»Ð°Ð²Ð¸Ðµ")}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3 text-sm",children:[e.jsx("div",{className:"font-semibold text-white",children:(Le=b==null?void 0:b.copy)==null?void 0:Le.headline}),e.jsx("p",{className:"mt-1 text-white/70",children:(Pe=b==null?void 0:b.copy)==null?void 0:Pe.body}),e.jsx(w,{variant:"subtle",className:"mt-3",onClick:()=>{var s,l;const t=`${(s=b==null?void 0:b.copy)==null?void 0:s.headline}

${(l=b==null?void 0:b.copy)==null?void 0:l.body}`;navigator.clipboard.writeText(t),H(o("Copy text ready to paste","Ð¢ÐµÐºÑÑ‚ÑŠÑ‚ Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð°Ð½"))},children:o("Copy text","ÐšÐ¾Ð¿Ð¸Ñ€Ð°Ð¹ Ñ‚ÐµÐºÑÑ‚Ð°")})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/25 p-3",children:[e.jsx("iframe",{ref:ue,title:"snippet-preview",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:((Re=b==null?void 0:b.attrs)==null?void 0:Re.height)||"520px",border:"0",borderRadius:"12px",background:((Ue=b==null?void 0:b.preview)==null?void 0:Ue.bg)||"#0b1120"}}),e.jsx("p",{className:"mt-2 text-xs text-white/60",children:o("Preview updates automatically. Paste the snippet anywhere on your site to launch the widget.","ÐŸÑ€ÐµÐ³Ð»ÐµÐ´ÑŠÑ‚ ÑÐµ Ð¾Ð±Ð½Ð¾Ð²ÑÐ²Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾. ÐŸÐ¾ÑÑ‚Ð°Ð²ÐµÑ‚Ðµ ÐºÐ¾Ð´Ð° Ð½Ð° ÑÐ°Ð¹Ñ‚Ð° ÑÐ¸, Ð·Ð° Ð´Ð° ÑÑ‚Ð°Ñ€Ñ‚Ð¸Ñ€Ð°Ñ‚Ðµ Ð²Ð¸Ð´Ð¶ÐµÑ‚Ð°.")})]})]})}),e.jsxs(se,{title:"Usage",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(P,{value:Y,onChange:t=>{be(t.target.value),ce(t.target.value)},children:c.map(t=>e.jsx("option",{value:t.id,children:t.id},t.id))}),e.jsx(w,{variant:"subtle",onClick:()=>ce(Y),disabled:!Y||ve,children:ve?"Loadingâ€¦":"Refresh"})]}),we.filter(t=>t&&t.event==="client_render").length===0?e.jsx("div",{className:"text-sm text-white/70",children:"No events yet."}):e.jsx("ul",{className:"space-y-1 text-xs",children:[...we].filter(t=>t&&t.event==="client_render").sort((t,s)=>((s==null?void 0:s.ts)||0)-((t==null?void 0:t.ts)||0)).map(t=>e.jsxs("li",{className:"rounded border border-white/10 bg-black/20 p-2",children:[e.jsx("span",{className:"opacity-80",children:"render"})," Â· ",e.jsx("span",{className:"opacity-60",children:new Date(t.ts).toLocaleString(void 0,{timeZoneName:"short"})})]},t.id||t.ts))})]}),e.jsxs(se,{title:"Stats & Usage",children:[e.jsx("div",{className:"mb-3 flex items-center gap-2",children:e.jsx(w,{variant:"subtle",onClick:Be,disabled:Se,children:Se?"Loadingâ€¦":"Refresh stats"})}),x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4 lg:grid-cols-6",children:[e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Ae=x==null?void 0:x.totals)==null?void 0:Ae.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Generations"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((De=x==null?void 0:x.last24h)==null?void 0:De.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Generations (24h)"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Me=x==null?void 0:x.clientTotals)==null?void 0:Me.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Client renders"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Oe=x==null?void 0:x.clientLast24h)==null?void 0:Oe.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Client renders (24h)"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Ie=x==null?void 0:x.plan)==null?void 0:Ie.monthlyGenerations)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Plan gens / mo"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:(x==null?void 0:x.monthlyUsed)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Used this month"})]})]}),e.jsx("div",{className:"mt-4 rounded-md border border-white/10 bg-black/30 p-3",children:(()=>{var h;const t=Number((x==null?void 0:x.monthlyUsed)||0),s=Number(((h=x==null?void 0:x.plan)==null?void 0:h.monthlyGenerations)||0)+Number((x==null?void 0:x.monthlyBonus)||0),l=s>0?Math.min(100,Math.round(t/s*100)):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs",children:[e.jsx("div",{className:"opacity-80",children:"Monthly generations"}),e.jsxs("div",{className:"opacity-70",children:[t," / ",s," ",x!=null&&x.monthlyBonus?`(+${x.monthlyBonus} bonus)`:""]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded bg-white/10",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 via-pink-500 to-cyan-400",style:{width:l+"%"}})}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center justify-between text-xs",children:[e.jsx("div",{className:"opacity-70",children:"$10 per extra 100 gens after limit"}),e.jsx(w,{className:"px-3 py-1",onClick:async()=>{if(window.__topupBusy)return;window.__topupBusy=!0;const p=event==null?void 0:event.currentTarget;p&&(p.disabled=!0);try{const S=await fetch("/api/billing/topup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({units:1})}),L=await S.json();if(!S.ok)throw new Error((L==null?void 0:L.error)||"Top-up failed");L!=null&&L.url&&(window.location.href=L.url)}catch(F){alert(F.message||"Top-up failed")}finally{window.__topupBusy=!1,p&&(p.disabled=!1)}},children:"Buy top-up"})]})]})})()})]}):e.jsx("div",{className:"text-sm text-white/70",children:"No stats yet."})]})]}),e.jsx(mt,{open:oe,step:He,placement:Ce,snippet:q,onClose:()=>{de(!1),te(1)},onCopy:$e,onNext:()=>te(t=>Math.min(3,t+1)),onPrev:()=>te(t=>Math.max(1,t-1)),onPlacement:Ee,onPreview:Ke,t:o})]})}function Je(){const[a,i]=ut();if(!a)return e.jsx(pt,{});const m=async()=>{try{await fetch("/api/client/me?action=logout",{method:"POST",headers:{Authorization:`Bearer ${a}`}})}catch{}i(""),window.location.href="/app/client.html"};return e.jsx(gt,{token:a,onSignOut:m})}class We extends qe.Component{constructor(i){super(i),this.state={hasError:!1,message:""}}static getDerivedStateFromError(i){return{hasError:!0,message:(i==null?void 0:i.message)||""}}componentDidCatch(i,m){try{console.error("Client portal error",i,m)}catch{}}render(){return this.state.hasError?e.jsxs("div",{className:"p-6 text-red-400",children:["Failed to load portal. Please hard refresh. ",this.state.message?`(${this.state.message})`:""]}):this.props.children}}const xe=()=>{const a=document.getElementById("root");a&&(at&&typeof ze.createRoot=="function"?ze.createRoot(a).render(e.jsx(We,{children:e.jsx(Je,{})})):he&&typeof he.render=="function"&&he.render(e.jsx(We,{children:e.jsx(Je,{})}),a))};document.readyState==="loading"?(document.addEventListener("DOMContentLoaded",xe,{once:!0}),setTimeout(xe,1500)):xe();(function(){if(new URLSearchParams(window.location.search).get("devtest")!=="1")return;const m=[],u=(v,C,$="")=>m.push({name:v,pass:!!C,detail:$}),c=me("abc",{attrs:{theme:"light",wide:"true",radius:"18px"}});u("snippet has script tag",/^<script\s.+><\/script>$/.test(c)),u("includes data-embed-id",c.includes('data-embed-id="abc"')),u("includes theme",c.includes('data-theme="light"')),u("includes wide toggle",c.includes('data-wide="true"'));const j=new URL(window.location.href);j.searchParams.set("token","T_URL");const y=j.searchParams.get("token")==="T_URL";u("URLSearchParams working",y),console.table(m.map(v=>({test:v.name,pass:v.pass,detail:v.detail})))})();
