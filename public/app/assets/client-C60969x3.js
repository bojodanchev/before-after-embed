import{c as B,j as e,r as n}from"./index-BQIBZnYE.js";const b=({className:t="",children:s})=>e.jsx("div",{className:`mx-auto w-full max-w-6xl px-4 sm:px-6 ${t}`,children:s}),v=({className:t="",children:s})=>e.jsx("div",{className:`ba-card border-neutral-200 dark:border-white/10 ${t}`,children:s}),k=({title:t,subtitle:s,right:i})=>e.jsxs("div",{className:"flex items-start justify-between gap-4 border-b border-neutral-100 p-4 dark:border-white/10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold",children:t}),s?e.jsx("p",{className:"mt-1 text-sm text-neutral-600 dark:text-white/60",children:s}):null]}),i]}),f=({className:t="",children:s})=>e.jsx("div",{className:`p-4 sm:p-6 ${t}`,children:s}),y=({variant:t="primary",className:s="",children:i,...o})=>{const d="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition",u={primary:"bg-gradient-to-r from-violet-600 via-pink-500 to-cyan-400 text-white hover:opacity-90 disabled:opacity-60",ghost:"bg-neutral-100 text-neutral-900 hover:bg-neutral-200 dark:bg-white/10 dark:text-white dark:hover:bg-white/20",outline:"border border-neutral-300 bg-white text-neutral-900 hover:bg-neutral-50 dark:border-white/20 dark:bg-transparent dark:text-white dark:hover:bg-white/10",subtle:"bg-neutral-100 text-neutral-900 hover:bg-neutral-200 dark:bg-white/10 dark:text-white dark:hover:bg-white/20"};return e.jsx("button",{className:`${d} ${u[t]} ${s}`,...o,children:i})},T=({className:t="",...s})=>e.jsx("input",{className:`w-full rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-violet-500 dark:border-white/20 dark:bg-white/5 dark:text-white ${t}`,...s}),N=({className:t="",children:s,...i})=>e.jsx("select",{className:`w-full rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-violet-500 dark:border-white/20 dark:bg-white/5 dark:text-white ${t}`,...i,children:s}),w=({children:t})=>e.jsx("label",{className:"text-xs font-medium text-neutral-700 dark:text-white/80",children:t}),$=({children:t,className:s=""})=>e.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-0.5 text-[10px] font-medium border-neutral-300 text-neutral-700 dark:border-white/20 dark:text-white/80 ${s}`,children:t}),S=({children:t})=>e.jsx("code",{className:"rounded-md bg-neutral-100 px-1.5 py-0.5 text-[12px] dark:bg-white/10",children:t}),P=()=>{const s=new URLSearchParams(window.location.search).get("token");if(s)return s;try{return localStorage.getItem("clientToken")||""}catch{return""}},I=t=>{const s=new URL(window.location.href);s.searchParams.set("token",t),window.history.replaceState({},"",s.toString())},R=()=>{try{localStorage.removeItem("clientToken")}catch{}const t=new URL(window.location.href);t.searchParams.delete("token"),window.history.replaceState({},"",t.toString())};async function L(t){try{const s=await t.json();return(s==null?void 0:s.error)||(s==null?void 0:s.message)}catch{return`${t.status} ${t.statusText}`}}const O=()=>{const[t,s]=n.useState(P()),[i,o]=n.useState(null),[d,u]=n.useState(!!t),[m,l]=n.useState("");return n.useEffect(()=>{if(!t){o(null),u(!1),l("");return}let a=!1;return(async()=>{u(!0),l("");try{const r=await fetch("/api/client/me",{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error(`${r.status}`);const g=await r.json();if(a)return;o((g==null?void 0:g.client)||null),u(!1);try{localStorage.setItem("clientToken",t)}catch{}I(t)}catch{if(a)return;l("Unable to load account. Please sign in again."),u(!1),o(null)}})(),()=>{a=!0}},[t]),{token:t,setToken:s,me:i,loadingMe:d,errorMe:m,signOut:()=>{o(null),s(""),R(),window.location.href="/app/client.html"}}},U=t=>{const[s,i]=n.useState([]),[o,d]=n.useState(!1),[u,m]=n.useState(""),l=async()=>{if(t){d(!0),m("");try{const a=await fetch("/api/client/embeds",{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error(`${a.status}`);const r=await a.json();i(Array.isArray(r)?r:(r==null?void 0:r.embeds)||[])}catch{m("Failed to load embeds.")}finally{d(!1)}}};return n.useEffect(()=>{l()},[t]),{embeds:s,loading:o,err:u,refresh:l,create:async a=>{const r=await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(a)});if(!r.ok)throw new Error(await L(r)||"Failed to create embed");await l()}}},z=(t,s)=>{const[i,o]=n.useState([]),[d,u]=n.useState(!1),[m,l]=n.useState("");return n.useEffect(()=>{if(!t||!s)return;let c=!1;return(async()=>{u(!0),l("");try{const a=await fetch(`/api/client/usage?embedId=${encodeURIComponent(s)}`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error(`${a.status}`);const r=await a.json(),j=(Array.isArray(r)?r:(r==null?void 0:r.events)||[]).map(h=>({type:h.event,embedId:h.embedId,status:h.event==="edit_success"?"ok":h.event,timestamp:h.ts?new Date(h.ts).toLocaleString():""}));c||o(j)}catch{c||l("Failed to load usage.")}finally{c||u(!1)}})(),()=>{c=!0}},[t,s]),{events:i,loading:d,err:m}},D=t=>{const[s,i]=n.useState(null),[o,d]=n.useState(!1),[u,m]=n.useState("");return{stats:s,loading:o,err:u,refresh:async()=>{if(t){d(!0),m("");try{const c=await fetch("/api/client/stats",{headers:{Authorization:`Bearer ${t}`}});if(!c.ok)throw new Error(`${c.status}`);const a=await c.json(),r=(a==null?void 0:a.totals)||{overall:0,byEmbed:{}},g=(a==null?void 0:a.last24h)||{overall:0,byEmbed:{}},j=Object.entries(r.byEmbed||{}).map(([h,p])=>({embedId:h,generations:p}));i({overall:{generations:r.overall,embeds:j.length},last24h:{generations:g.overall},byEmbed:j})}catch{m("Failed to load stats.")}finally{d(!1)}}}}},M=({me:t,onSignOut:s})=>e.jsx("header",{className:"sticky top-0 z-40 border-b border-neutral-200 bg-white/80 backdrop-blur dark:border-white/10 dark:bg-neutral-950/70",children:e.jsxs(b,{className:"flex h-14 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-8 w-8 place-items-center rounded-xl bg-gradient-to-tr from-violet-500 via-pink-500 to-cyan-400 shadow",children:e.jsx("span",{className:"text-xs font-bold text-white",children:"B/A"})}),e.jsx("span",{className:"text-sm font-semibold",children:"Before/After — Client Portal"})]}),t?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{children:"Client"}),e.jsxs("div",{className:"hidden text-sm sm:block",children:[e.jsx("span",{className:"opacity-80",children:t.name})," ",e.jsx("span",{className:"opacity-50",children:"·"})," ",e.jsx(S,{children:t.id})]}),e.jsx(y,{variant:"outline",onClick:s,children:"Sign out"})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Not signed in"})]})}),A=({onToken:t})=>{const[s,i]=n.useState(""),[o,d]=n.useState(!1),[u,m]=n.useState(""),[l,c]=n.useState(""),a=async r=>{r.preventDefault(),m(""),c(""),d(!0);try{const g=await fetch("/api/client/me",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})});if(!g.ok)throw new Error(await L(g));const j=await g.json(),h=j==null?void 0:j.link,x=new URL(h,window.location.origin).searchParams.get("token");if(x){try{localStorage.setItem("clientToken",x)}catch{}I(x),t(x)}else c("Sign-in link sent. Check your email.")}catch(g){m(g.message||"Sign-in failed.")}finally{d(!1)}};return e.jsx(b,{className:"py-10",children:e.jsxs(v,{className:"mx-auto max-w-md",children:[e.jsx(k,{title:"Sign in",subtitle:"Enter your email to get a magic link."}),e.jsx(f,{children:e.jsxs("form",{className:"grid gap-3",onSubmit:a,children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(w,{children:"Email"}),e.jsx(T,{type:"email",required:!0,placeholder:"you@company.com",value:s,onChange:r=>i(r.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{type:"submit",disabled:o,children:o?"Sending…":"Send link"}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400",children:u}),e.jsx("span",{className:"text-neutral-600 dark:text-white/70",children:l})]})]})]})})]})})},F=({token:t,hook:s})=>{const{embeds:i,loading:o,err:d,refresh:u,create:m}=s||U(t),[l,c]=n.useState({id:"",vertical:"barber",theme:"dark"}),[a,r]=n.useState(!1),[g,j]=n.useState(""),h=async p=>{p.preventDefault(),j("");const x=l.id.trim();if(!/^[a-z0-9-]{3,32}$/.test(x)){j("Use 3-32 chars: lowercase letters, numbers, dashes");return}r(!0);try{await m({id:x,vertical:l.vertical,theme:l.theme}),c({id:"",vertical:l.vertical,theme:l.theme})}catch(C){j(C.message)}finally{r(!1)}};return e.jsx(b,{className:"py-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(v,{children:[e.jsx(k,{title:"Your embeds",subtitle:"Manage embed IDs, verticals, and themes.",right:e.jsx(y,{variant:"subtle",onClick:u,children:"Refresh"})}),e.jsx(f,{children:o?e.jsx("div",{className:"text-sm opacity-70",children:"Loading…"}):d?e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:d}):i.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No embeds yet. Create your first embed."}):e.jsx("div",{className:"divide-y divide-neutral-200 dark:divide-white/10",children:i.map(p=>e.jsxs("div",{className:"flex items-center justify-between gap-3 py-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:p.id}),e.jsxs("div",{className:"text-xs opacity-70",children:[e.jsx("span",{className:"uppercase",children:p.vertical})," · ",e.jsx(S,{children:p.theme})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-xs underline opacity-80 hover:opacity-100",onClick:()=>{try{navigator.clipboard.writeText(p.id)}catch{}},children:"Copy ID"}),e.jsx("a",{className:"text-xs underline opacity-80 hover:opacity-100",target:"_blank",rel:"noreferrer",href:`/widget.html?embedId=${encodeURIComponent(p.id)}&theme=${encodeURIComponent(p.theme)}`,children:"Open"})]})]},p.id))})})]}),e.jsxs(v,{children:[e.jsx(k,{title:"Create embed",subtitle:"Provision an embed for a client/tenant."}),e.jsx(f,{children:e.jsxs("form",{className:"grid gap-3",onSubmit:h,children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(w,{children:"Embed ID"}),e.jsx(T,{placeholder:"acme-barber-01",required:!0,value:l.id,onChange:p=>c(x=>({...x,id:p.target.value}))})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(w,{children:"Vertical"}),e.jsxs(N,{value:l.vertical,onChange:p=>c(x=>({...x,vertical:p.target.value})),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(w,{children:"Theme"}),e.jsxs(N,{value:l.theme,onChange:p=>c(x=>({...x,theme:p.target.value})),children:[e.jsx("option",{value:"light",children:"light"}),e.jsx("option",{value:"dark",children:"dark"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{type:"submit",disabled:a,children:a?"Creating…":"Create embed"}),e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400",children:g})]})]})})]})]})})},q=({defaultEmbedId:t="",embedsHook:s})=>{const[i,o]=n.useState(t),[d,u]=n.useState("compact"),[m,l]=n.useState("dark"),[c,a]=n.useState(!1),r=(s==null?void 0:s.embeds)||[];n.useEffect(()=>{!i&&r.length&&o(r[0].id)},[r,i]);const g=n.useMemo(()=>`<script ${["async",'src="https://before-after-embed.vercel.app/embed.js"',`data-embed-id="${i||"your-embed-id"}"`,`data-theme="${m}"`,`data-variant="${d}"`,'data-max-width="640px"','data-align="center"','data-radius="14px"','data-shadow="true"','data-border="true"','data-width="100%"','data-height="460px"'].join(" ")}><\/script>`,[i,d,m]),j=async()=>{try{await navigator.clipboard.writeText(g),a(!0),setTimeout(()=>a(!1),1500)}catch{}};return e.jsx(b,{className:"py-6",children:e.jsxs(v,{children:[e.jsx(k,{title:"Snippet builder",subtitle:"Configure and copy a ready-to-paste embed script.",right:c?e.jsx($,{className:"border-emerald-400 text-emerald-500 dark:border-emerald-400/60",children:"Copied"}):null}),e.jsxs(f,{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(w,{children:"Embed ID"}),r.length?e.jsx(N,{value:i,onChange:h=>o(h.target.value),children:r.map(h=>e.jsx("option",{value:h.id,children:h.id},h.id))}):e.jsx(T,{placeholder:"your-embed-id",value:i,onChange:h=>o(h.target.value)})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(w,{children:"Preset"}),e.jsxs(N,{value:d,onChange:h=>u(h.target.value),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(w,{children:"Theme"}),e.jsxs(N,{value:m,onChange:h=>l(h.target.value),children:[e.jsx("option",{value:"light",children:"light"}),e.jsx("option",{value:"dark",children:"dark"})]})]})]}),e.jsxs("div",{className:"grid content-start gap-3",children:[e.jsx("div",{className:"rounded-xl border border-neutral-200 bg-neutral-50 p-3 text-xs dark:border-white/10 dark:bg-black/40",children:e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:g})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{onClick:j,children:"Copy snippet"}),e.jsxs("span",{className:"text-xs opacity-70",children:["Includes ",e.jsx(S,{children:"data-variant"}),", ",e.jsx(S,{children:"data-theme"}),", sizing and styles."]})]})]})]})]})})},J=({token:t,embeds:s})=>{var g,j,h,p;const[i,o]=n.useState(((g=s==null?void 0:s[0])==null?void 0:g.id)||""),{events:d,loading:u,err:m}=z(t,i),{stats:l,loading:c,err:a,refresh:r}=D(t);return n.useEffect(()=>{t&&r()},[t]),n.useEffect(()=>{s!=null&&s.length&&!i&&o(s[0].id)},[s,i]),e.jsx(b,{className:"py-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(v,{children:[e.jsx(k,{title:"Usage (recent events)",subtitle:"Filter by embed ID.",right:e.jsx(N,{value:i,onChange:x=>o(x.target.value),children:s.map(x=>e.jsx("option",{value:x.id,children:x.id},x.id))})}),e.jsx(f,{children:u?e.jsx("div",{className:"text-sm opacity-70",children:"Loading…"}):m?e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:m}):d.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No events yet."}):e.jsx("div",{className:"divide-y divide-neutral-200 text-sm dark:divide-white/10",children:d.map((x,C)=>e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"truncate",children:[e.jsx("span",{className:"opacity-70",children:x.type})," · ",e.jsx(S,{children:x.embedId})]}),e.jsx("div",{className:"text-xs opacity-60",children:x.timestamp})]}),e.jsx($,{children:x.status||"ok"})]},C))})})]}),e.jsxs(v,{children:[e.jsx(k,{title:"Stats",subtitle:"Totals and last 24h",right:e.jsx(y,{variant:"subtle",onClick:r,children:"Refresh"})}),e.jsx(f,{children:c?e.jsx("div",{className:"text-sm opacity-70",children:"Loading…"}):a?e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:a}):l?e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:[e.jsx(E,{label:"Total generations",value:((j=l.overall)==null?void 0:j.generations)??0}),e.jsx(E,{label:"Embeds",value:((h=l.overall)==null?void 0:h.embeds)??0}),e.jsx(E,{label:"Gen (24h)",value:((p=l.last24h)==null?void 0:p.generations)??0}),e.jsx(E,{label:"—",value:""})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 text-sm font-semibold opacity-80",children:"By embed"}),e.jsx("div",{className:"divide-y divide-neutral-200 text-sm dark:divide-white/10",children:(l.byEmbed||[]).map(x=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("div",{className:"truncate",children:x.embedId}),e.jsx("div",{className:"opacity-80",children:x.generations})]},x.embedId))})]})]}):e.jsx("div",{className:"text-sm opacity-70",children:"No stats yet."})})]})]})})},E=({label:t,value:s})=>e.jsxs("div",{className:"rounded-xl border border-neutral-200 bg-neutral-50 p-3 text-center dark:border-white/10 dark:bg-white/5",children:[e.jsx("div",{className:"text-2xl font-semibold",children:s}),e.jsx("div",{className:"text-xs opacity-70",children:t})]}),W=()=>{const{token:t,setToken:s,me:i,loadingMe:o,errorMe:d,signOut:u}=O(),m=U(t);return n.useEffect(()=>{const c=new URLSearchParams(window.location.search).get("token");if(c){try{localStorage.setItem("clientToken",c)}catch{}I(c)}},[]),e.jsxs("div",{className:"min-h-screen pb-16",children:[e.jsx(M,{me:i,onSignOut:u}),t?o?e.jsx(b,{className:"py-10",children:e.jsx(v,{children:e.jsx(f,{children:e.jsx("div",{className:"text-sm opacity-70",children:"Loading account…"})})})}):d?e.jsx(b,{className:"py-10",children:e.jsx(v,{children:e.jsxs(f,{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:d}),e.jsx(y,{variant:"outline",onClick:()=>s(""),children:"Sign in"})]})})}):i?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"py-6",children:e.jsx(v,{children:e.jsxs(f,{className:"flex flex-col items-start justify-between gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm opacity-70",children:"Welcome"}),e.jsx("div",{className:"text-lg font-semibold",children:i.name}),e.jsxs("div",{className:"text-xs opacity-60",children:["Client ID: ",e.jsx(S,{children:i.id})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(y,{variant:"ghost",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),children:"Back to top"})})]})})}),e.jsx(F,{token:t,hook:m}),e.jsx(q,{embedsHook:m}),e.jsx(_,{token:t})]}):e.jsx(A,{onToken:s}):e.jsx(A,{onToken:s}),e.jsx("footer",{className:"mt-10 border-t border-neutral-200 py-8 text-center text-sm opacity-70 dark:border-white/10",children:"© 2025 Before/After Embed"})]})},_=({token:t})=>{const[s,i]=n.useState([]),[o,d]=n.useState(!0),[u,m]=n.useState("");return n.useEffect(()=>{let l=!1;return(async()=>{if(t){d(!0),m("");try{const c=await fetch("/api/client/embeds",{headers:{Authorization:`Bearer ${t}`}});if(!c.ok)throw new Error(`${c.status}`);const a=await c.json();l||i(Array.isArray(a)?a:(a==null?void 0:a.embeds)||[])}catch{l||m("Failed to load embeds for usage/stats.")}finally{l||d(!1)}}})(),()=>{l=!0}},[t]),o?e.jsx(b,{className:"py-6",children:e.jsx("div",{className:"text-sm opacity-70",children:"Loading usage & stats…"})}):u?e.jsx(b,{className:"py-6",children:e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:u})}):s.length?e.jsx(J,{token:t,embeds:s}):null};B.createRoot(document.getElementById("root")).render(e.jsx(W,{}));
