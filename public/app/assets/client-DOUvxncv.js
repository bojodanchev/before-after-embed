import{a as oe,c as Y,j as e,b as D,r,R as ce}from"./index-B-YkB1ak.js";const de=()=>{const i=new URLSearchParams(window.location.search).get("token");if(i)return i;try{return localStorage.getItem("clientToken")||""}catch{return""}},Z=s=>{try{localStorage.setItem("clientToken",s)}catch{}},he=()=>{try{localStorage.removeItem("clientToken")}catch{}};async function E(s){try{const i=await s.json();return(i==null?void 0:i.error)||(i==null?void 0:i.message)||`${s.status}`}catch{return`${s.status} ${s.statusText}`}}const A=(s,i,x)=>`<script ${["async",'src="https://before-after-embed.vercel.app/embed.js"',`data-embed-id="${s||"your-embed-id"}"`,`data-theme="${x}"`,`data-variant="${i}"`,'data-max-width="640px"','data-align="center"','data-radius="14px"','data-shadow="true"','data-border="true"','data-width="100%"','data-height="460px"'].join(" ")}><\/script>`,me=({className:s="",children:i})=>e.jsx("div",{className:`mx-auto w-full max-w-6xl px-4 sm:px-6 ${s}`,children:i}),R=({title:s,children:i})=>e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-6",children:[s&&e.jsx("h2",{className:"text-base font-semibold",children:s}),e.jsx("div",{className:s?"mt-3":"",children:i})]}),m=({variant:s="primary",className:i="",children:x,...l})=>{const c="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition",v={primary:"text-white bg-gradient-to-r from-violet-600 via-pink-500 to-cyan-400 hover:opacity-90 disabled:opacity-60",outline:"border border-white/20 bg-transparent text-white hover:bg-white/10",subtle:"bg-white/10 text-white hover:bg-white/20"};return e.jsx("button",{className:`${c} ${v[s]} ${i}`,...l,children:x})},j=s=>e.jsx("input",{...s,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white placeholder-white/50 focus:ring-2 focus:ring-violet-500"}),b=({children:s,...i})=>e.jsx("select",{...i,className:"w-full rounded-md border border-white/20 bg-neutral-900 p-2 text-sm text-white focus:ring-2 focus:ring-violet-500",children:s}),xe=({children:s})=>e.jsx("code",{className:"rounded-md bg-black/40 px-1.5 py-0.5 text-[12px]",children:s});function ue(){const[s,i]=r.useState("");return r.useEffect(()=>{const l=new URLSearchParams(window.location.search),c=l.get("token")||de();c&&(i(c),Z(c),l.get("token")&&(l.delete("token"),window.history.replaceState({},"",window.location.pathname)))},[]),[s,l=>{i(l||""),l?Z(l):he()}]}function pe(){const[s,i]=r.useState(""),[x,l]=r.useState(!1),[c,v]=r.useState(""),[k,p]=r.useState(""),S=async g=>{g.preventDefault(),l(!0),v(""),p("");try{const o=await fetch("/api/client/me",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})});if(!o.ok)throw new Error(await E(o));const u=await o.json();if(u!=null&&u.link)window.location.href=u.link;else if(u!=null&&u.token){const w=new URL(window.location.href);w.searchParams.set("token",u.token),window.location.replace(w.toString())}else p("Sign-in link sent. Check your email.")}catch(o){v(typeof(o==null?void 0:o.message)=="string"?o.message:"Failed to send sign-in link")}finally{l(!1)}};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-neutral-950 text-white",children:e.jsxs("form",{onSubmit:S,className:"w-full max-w-sm rounded-xl border border-white/10 bg-white/5 p-6",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Client Portal Sign In"}),e.jsx(j,{type:"email",placeholder:"you@example.com",value:s,onChange:g=>i(g.target.value),required:!0}),e.jsx(m,{type:"submit",className:"mt-4 w-full",disabled:x,children:x?"Sending…":"Send sign-in link"}),!!c&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:c}),!!k&&e.jsx("p",{className:"mt-2 text-sm text-white/70",children:k})]})})}function ge({token:s,onSignOut:i}){var Q,X;const[x,l]=r.useState(null),[c,v]=r.useState([]),[k,p]=r.useState(!0),[S,g]=r.useState(""),[o,u]=r.useState({id:"",vertical:"barber",theme:"dark"}),[w,P]=r.useState(""),[$,ae]=r.useState("compact"),[B,se]=r.useState("dark"),T=r.useMemo(()=>A(w,$,B),[w,$,B]),[L,O]=r.useState(""),z=ce.useRef(null);r.useEffect(()=>{O(T)},[T]);const M=t=>{var a;try{const n=z.current;if(!n)return;const h=n.contentDocument||((a=n.contentWindow)==null?void 0:a.document);if(!h)return;const N=`<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/></head><body style="margin:0;background:#0b0d10;color:#e6eaf2;font-family:Inter,ui-sans-serif,system-ui">${t}</body></html>`;h.open(),h.write(N),h.close()}catch{}};r.useEffect(()=>{const t=setTimeout(()=>M(L),250);return()=>clearTimeout(t)},[L]);const[I,F]=r.useState(""),[J,H]=r.useState([]),[W,_]=r.useState(!1),[y,q]=r.useState(null),[V,G]=r.useState(!1),[ie,U]=r.useState(!1),[d,f]=r.useState({id:"",name:"",vertical:"barber",theme:"dark",width:"100%",height:"520px",variant:"card",radius:"12px",shadow:"true",border:"true"}),C=async()=>{try{p(!0),g("");const t=await fetch("/api/client/me",{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error("Auth failed");const a=await t.json();l((a==null?void 0:a.client)||a);const n=await fetch("/api/client/embeds",{headers:{Authorization:`Bearer ${s}`}});if(!n.ok)throw new Error(await E(n));const h=await n.json(),N=Array.isArray(h)?h:(h==null?void 0:h.embeds)||[];v(N),!w&&N.length&&P(N[0].id),!I&&N.length&&F(N[0].id)}catch{g("Failed to load data")}finally{p(!1)}};r.useEffect(()=>{C()},[s]);const ne=async t=>{t.preventDefault();try{const a=await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(o)});if(!a.ok)throw new Error(await E(a));u({id:"",vertical:o.vertical,theme:o.theme}),C()}catch(a){g(typeof(a==null?void 0:a.message)=="string"?a.message:"Failed to create embed")}},re=async(t,a)=>{try{const n=await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({id:t,theme:a})});if(!n.ok)throw new Error(await E(n));C()}catch(n){g(typeof(n==null?void 0:n.message)=="string"?n.message:"Failed to update embed")}},K=async t=>{if(t){_(!0);try{const a=await fetch(`/api/client/usage?embedId=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${s}`}});if(!a.ok)throw new Error(await E(a));const n=await a.json(),h=Array.isArray(n)?n:(n==null?void 0:n.events)||[];H(h)}catch{H([])}finally{_(!1)}}},le=async()=>{G(!0);try{const t=await fetch("/api/client/stats",{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error(await E(t));const a=await t.json();q(a||null)}catch{q(null)}finally{G(!1)}};return k?e.jsx("div",{className:"p-6 text-white",children:"Loading…"}):S?e.jsx("div",{className:"p-6 text-red-400",children:S}):e.jsxs("div",{className:"min-h-screen bg-neutral-950 text-white",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-white/10 bg-neutral-950/80 backdrop-blur",children:e.jsxs(me,{className:"flex h-14 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-8 w-8 place-items-center rounded-xl bg-gradient-to-tr from-violet-500 via-pink-500 to-cyan-400 shadow",children:e.jsx("span",{className:"text-xs font-bold",children:"B/A"})}),e.jsx("div",{className:"text-sm font-semibold",children:"Before/After Portal"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[x&&e.jsxs("span",{children:[x.name," (",e.jsx(xe,{children:x.id}),")"]}),e.jsx(m,{variant:"outline",onClick:i,children:"Sign out"})]})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl space-y-8 p-4",children:[e.jsxs(R,{title:"Embeds",children:[e.jsx("ul",{className:"space-y-2 text-sm",children:c.map(t=>e.jsxs("li",{className:"flex flex-col gap-2 rounded-md border border-white/10 bg-black/20 p-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"truncate",children:[t.id," – ",t.vertical," – ",t.theme]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(b,{value:t.theme,onChange:a=>re(t.id,a.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(m,{variant:"subtle",onClick:()=>P(t.id),children:"Use in Snippet"}),e.jsx(m,{variant:"outline",onClick:()=>navigator.clipboard.writeText(A(t.id,$,t.theme)),children:"Copy Snippet"}),e.jsx("a",{className:"text-xs underline",target:"_blank",rel:"noreferrer",href:`/widget.html?embedId=${encodeURIComponent(t.id)}&theme=${encodeURIComponent(t.theme)}`,children:"Open"}),e.jsx(m,{variant:"outline",onClick:()=>{f({...t,variant:t.variant||"card",radius:t.radius||"12px",shadow:t.shadow??"true",border:t.border??"true"}),U(!0)},children:"Edit"}),e.jsx(m,{variant:"outline",onClick:async()=>{const a=`${t.id}-copy`;await fetch("/api/client/embeds",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({...t,id:a,name:t.name||a})}),C()},children:"Duplicate"}),e.jsx(m,{variant:"outline",onClick:async()=>{if(!confirm(`Delete embed ${t.id}?`))return;const a=new URL("/api/client/embeds",location.origin);a.searchParams.set("id",t.id),await fetch(a.toString(),{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),C()},children:"Delete"})]})]},t.id))}),e.jsxs("form",{onSubmit:ne,className:"mt-4 grid gap-2 md:grid-cols-4",children:[e.jsx(j,{placeholder:"id",value:o.id,onChange:t=>u({...o,id:t.target.value}),required:!0}),e.jsxs(b,{value:o.vertical,onChange:t=>u({...o,vertical:t.target.value}),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]}),e.jsxs(b,{value:o.theme,onChange:t=>u({...o,theme:t.target.value}),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]}),e.jsx(m,{type:"submit",className:"md:col-span-4",children:"Create"})]})]}),ie&&e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-xl rounded-xl border border-white/10 bg-neutral-950 p-4 text-white",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Edit embed"}),e.jsx("button",{className:"text-white/70",onClick:()=>U(!1),children:"✕"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"ID"}),e.jsx(j,{value:d.id,disabled:!0})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Name"}),e.jsx(j,{value:d.name||"",onChange:t=>f(a=>({...a,name:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Vertical"}),e.jsxs(b,{value:d.vertical,onChange:t=>f(a=>({...a,vertical:t.target.value})),children:[e.jsx("option",{value:"barber",children:"barber"}),e.jsx("option",{value:"dental",children:"dental"}),e.jsx("option",{value:"detailing",children:"detailing"}),e.jsx("option",{value:"cosmetics",children:"cosmetics"}),e.jsx("option",{value:"custom",children:"custom"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Variant"}),e.jsxs(b,{value:d.variant,onChange:t=>f(a=>({...a,variant:t.target.value})),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Width"}),e.jsx(j,{value:d.width,onChange:t=>f(a=>({...a,width:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Height"}),e.jsx(j,{value:d.height,onChange:t=>f(a=>({...a,height:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Radius"}),e.jsx(j,{value:d.radius,onChange:t=>f(a=>({...a,radius:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Border"}),e.jsxs(b,{value:d.border,onChange:t=>f(a=>({...a,border:t.target.value})),children:[e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Shadow"}),e.jsxs(b,{value:d.shadow,onChange:t=>f(a=>({...a,shadow:t.target.value})),children:[e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]})]}),e.jsxs("div",{className:"mt-4 grid gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-white/70",children:"Live preview"}),e.jsx("iframe",{title:"edit-preview",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:"360px",border:"0",borderRadius:"10px",background:"#0b0d10"},ref:t=>{var h;if(!t)return;const a=A(d.id,d.variant,d.theme||"dark").replace('data-width="100%"','data-width="'+(d.width||"100%")+'"').replace('data-height="460px"','data-height="'+(d.height||"520px")+'"'),n=t.contentDocument||((h=t.contentWindow)==null?void 0:h.document);n&&(n.open(),n.write(`<!doctype html><html><body style="margin:0;background:#0b0d10">${a}</body></html>`),n.close())}})]}),e.jsxs("div",{className:"flex flex-col justify-end gap-2",children:[e.jsx(m,{onClick:async()=>{const t={...d};await fetch("/api/client/embeds",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(t)}),U(!1),C()},children:"Save changes"}),e.jsx(m,{variant:"subtle",onClick:()=>U(!1),children:"Cancel"})]})]})]})}),e.jsxs(R,{title:"Snippet Builder",children:[e.jsxs("div",{className:"grid gap-2 md:grid-cols-3",children:[e.jsx(j,{placeholder:"embedId",value:w,onChange:t=>P(t.target.value)}),e.jsxs(b,{value:$,onChange:t=>ae(t.target.value),children:[e.jsx("option",{value:"compact",children:"compact"}),e.jsx("option",{value:"card",children:"card"})]}),e.jsxs(b,{value:B,onChange:t=>se(t.target.value),children:[e.jsx("option",{value:"dark",children:"dark"}),e.jsx("option",{value:"light",children:"light"})]})]}),e.jsx("pre",{className:"mt-4 whitespace-pre-wrap break-words rounded-md bg-black/60 p-2 text-xs",children:T}),e.jsx(m,{className:"mt-2",onClick:()=>navigator.clipboard.writeText(T),children:"Copy snippet"})]}),e.jsx(R,{title:"Live Snippet Preview (iframe sandbox)",children:e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("textarea",{value:L,onChange:t=>O(t.target.value),rows:10,className:"w-full rounded-md border border-white/10 bg-black/40 p-2 text-xs font-mono"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(m,{variant:"subtle",onClick:()=>O(T),children:"Reset to builder"}),e.jsx(m,{onClick:()=>M(L),children:"Run preview"})]})]}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-black/20 p-2",children:e.jsx("iframe",{ref:z,title:"snippet-preview",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:"520px",border:"0",borderRadius:"10px",background:"#0b0d10"}})})]})}),e.jsxs(R,{title:"Usage",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(b,{value:I,onChange:t=>{F(t.target.value),K(t.target.value)},children:c.map(t=>e.jsx("option",{value:t.id,children:t.id},t.id))}),e.jsx(m,{variant:"subtle",onClick:()=>K(I),disabled:!I||W,children:W?"Loading…":"Refresh"})]}),J.length===0?e.jsx("div",{className:"text-sm text-white/70",children:"No events yet."}):e.jsx("ul",{className:"space-y-1 text-xs",children:J.map(t=>e.jsxs("li",{className:"rounded border border-white/10 bg-black/20 p-2",children:[e.jsx("span",{className:"opacity-80",children:t.event})," · ",e.jsx("span",{className:"opacity-60",children:new Date(t.ts).toLocaleString()})]},t.id||t.ts))})]}),e.jsxs(R,{title:"Stats (last 24h)",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{variant:"subtle",onClick:le,disabled:V,children:V?"Loading…":"Refresh stats"})}),y?e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((Q=y==null?void 0:y.totals)==null?void 0:Q.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Total events"})]}),e.jsxs("div",{className:"rounded-md border border-white/10 bg-black/20 p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:((X=y==null?void 0:y.last24h)==null?void 0:X.overall)??0}),e.jsx("div",{className:"text-xs opacity-70",children:"Events (24h)"})]})]}):e.jsx("div",{className:"text-sm text-white/70",children:"No stats yet."})]})]})]})}function ee(){const[s,i]=ue();return s?e.jsx(ge,{token:s,onSignOut:()=>{i(""),window.location.href="/app/client.html"}}):e.jsx(pe,{})}const te=()=>{const s=document.getElementById("root");s&&(oe&&typeof Y.createRoot=="function"?Y.createRoot(s).render(e.jsx(ee,{})):D&&typeof D.render=="function"&&D.render(e.jsx(ee,{}),s))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",te,{once:!0}):te();(function(){if(new URLSearchParams(window.location.search).get("devtest")!=="1")return;const x=[],l=(p,S,g="")=>x.push({name:p,pass:!!S,detail:g}),c=A("abc","compact","dark");l("snippet has script tag",/^<script\s.+><\/script>$/.test(c)),l("includes data-embed-id",c.includes('data-embed-id="abc"')),l("includes variant",c.includes('data-variant="compact"')),l("includes theme",c.includes('data-theme="dark"'));const v=new URL(window.location.href);v.searchParams.set("token","T_URL");const k=v.searchParams.get("token")==="T_URL";l("URLSearchParams working",k),console.table(x.map(p=>({test:p.name,pass:p.pass,detail:p.detail})))})();
